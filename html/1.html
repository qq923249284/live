<!DOCTYPE html>
<html>
<head>
    <title>趣嗒嗒北京分公司开业直播</title>
    <meta name="description" content="微赞直播1分钟完成创建、支持语音图文视频直播、直播过程清晰无卡顿内容实时保存，随时可回放、支持送礼赞赏评论+聊天，互动丰富不受时间场合流量限制、一台手机搞定直播，为您提供愉悦的网上直播体验!">
    <meta name="Keywords" content="微赞直播,视频,语音,图文,直播--企业直播，微信直播，教育直播，培训直播，新媒体直播，视频直播系统，网络视频直播系统，企业视频新媒体系统，企业直播培训系统">
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
    <meta name="format-detection" content="address=no">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="shortcut icon" href="/livecontent/vzan.ico" />
    <link rel="stylesheet" href="https://j.vzan.cc/zhibo/livecontent/content/weui/weui.min.css?ver=637046605863177993">
    <link rel="stylesheet" href="https://j.vzan.cc/zhibo/livecontent/public/css/base.css?ver=637046605863177993" />
    <link rel="stylesheet" href="https://j.vzan.cc/zhibo/css/animate.css?ver=637046605863177993" />
    <link rel="stylesheet" href="https://j.vzan.cc/zhibo/livecontent/livecommon/css/loading-animate.css?ver=637046605863177993">
    <script src="https://j.vzan.cc/zhibo/js/??jquery-2.1.4.min.js,jweixin-1.4.0.js,jquery.cookie.js,vue.min.js,vue-router.min.js?ver=637046605863177993"></script>
    <script src="https://j.vzan.cc/zhibo/livecontent/public/js/base.js?ver=637046605863177993"></script>
    <script src="https://j.vzan.cc/zhibo/livecontent/public/layui-v2.1.5/layui.js"></script>
    <script>
        var baseURL = "";
        var token = $('<input name="__RequestVerificationToken" type="hidden" value="JRTCwBIXuISDcxAcAK1tdT2SG0rhgj7XGJ6cZ8BKmwpZSlMNdKwwUzmKHZL7kUbcJttzoWJJ4CU2F_zTkd2fFwqLiJ81" />').val();
        if ('' != '') {
            wx.config(
            {
                debug: false,
                appId: "",
                timestamp: "",
                nonceStr: "",
                signature: "",
                jsApiList: [
                    "checkJsApi",
                    "onMenuShareTimeline",
                    "onMenuShareAppMessage",
                    "onMenuShareQQ",
                    "onMenuShareQZone",
                    "onMenuShareWeibo",
                    "hideMenuItems",
                    "showMenuItems",
                    "hideAllNonBaseMenuItem",
                    "showAllNonBaseMenuItem",
                    "translateVoice",
                    "startRecord",
                    "stopRecord",
                    "onRecordEnd",
                    "playVoice",
                    "pauseVoice",
                    "stopVoice",
                    "uploadVoice",
                    "downloadVoice",
                    "chooseImage",
                    "previewImage",
                    "uploadImage",
                    "downloadImage",
                    "getNetworkType",
                    "openLocation",
                    "getLocation",
                    "hideOptionMenu",
                    "showOptionMenu",
                    "closeWindow",
                    "scanQRCode",
                    "chooseWXPay",
                    "openProductSpecificView",
                    "addCard",
                    "chooseCard",
                    "openCard"
                ]
            });
        }

        wx.ready(function () {
            if ('1' == '1') {
                wx.showOptionMenu();
            }
            else {
                wx.hideOptionMenu();
            }
        });
        window.onload = function () {
            layui && layui.use("layer");
        }
    </script>
</head>



<link rel="stylesheet" href="https://j.vzan.cc/zhibo/livecontent/plugin/swiper-4.4.1/css/swiper.min.css?ver=637046605863177993" />
<link rel="stylesheet" href="https://j.vzan.cc/zhibo/livecontent/weddingNew/css/weui.min.css?ver=637046605863177993" />
<link rel="stylesheet" href="https://j.vzan.cc/zhibo/livecontent/public/popup/popup.css?ver=637046605863177993" />
<link rel="stylesheet" href="https://j.vzan.cc/zhibo/livecontent/topic/css/npic-live.css?ver=6370466058631779930811" />
<link href="https://j.vzan.cc/zhibo/livecontent/new-2019/css/theme-skin.css?ver=637046605863177993" rel="stylesheet" />
<link rel="stylesheet" href="https://j.vzan.cc/zhibo/livecontent/plugin/video2019/video2019.css?ver=637046605863177993" />
<script src="https://j.vzan.cc/zhibo/livecontent/plugin/video2019/hls-0714.js?ver=637046605863177993"></script>
<script rel="stylesheet" src="https://j.vzan.cc/zhibo/livecontent/plugin/gif/gif.js"></script>

<style>
    .Complaint {
        color: #3B97FF; /*text-align: center;*/ /*display:block;*/ /*width:100%;*/
        font-size: 14px;
    }

    .picDetail-ope-item:last-child {
        margin: 0;
    }

    .c-float-popWrap .c-float-modePop .warnMsg {
        font-size: 14px;
    }
</style>

<body class="fashiongold play">
    <div hidden="hidden" id="QRCode"></div>
    <!--微信分享-->
    <div class="live_title_bar webkitBox" style="display:none;" attr-title="趣嗒嗒北京分公司开业直播" attr-descript="" attr-state="1" attr-pic="https://i2cut.vzan.cc/image/liveimg/jpeg/2019/8/18/141459091ea87846f54fac810bdc58bde2110b.jpeg?imageView2/2/w/640/q/90" attr-url="https://vzan.com/live/tvchat-1935643604?ver=637047595925118249" attr-zbId="733664" attr-shareset="0"></div>

    <div class="vzanPicture" ref="pic" v-cloak :style="{position: jjgsaw ? 'fixed':'relative'}">
        <div v-if="isModifyTw" @click="toModifyTw" class="to-modify">编辑图文故事</div>
        <div class="vzanPicture-header">

            <img src="https://i2cut.vzan.cc/image/liveimg/jpeg/2019/8/18/141459091ea87846f54fac810bdc58bde2110b.jpeg?imageView2/1/w/1280/h/720/q/90" alt="" v-if="(pageData.topic.AdPvType==1 && pageData.topic.Posters=='')|| pageData.topic.RelayId!=0" />
            <img :src="pageData.topic.Posters" v-else-if="pageData.topic.AdPvType==1&&pageData.topic.Posters.indexOf(',')<0" />

            <div class="pic-head-slide" v-else-if="pageData.topic.AdPvType==1&&pageData.topic.Posters.split(',').length>1">
                <div class="swiper-wrapper">
                    <div class="swiper-slide" v-for="item in pageData.topic.Posters.split(',')">
                        <img :src="item.replace('i2.vzan','i2cut.vzan')+'?imageMogr2/auto-orient/thumbnail/900x'">
                    </div>
                </div>
                <div class="swiper-pagination"></div>
            </div>

            <div id="video-container" v-if="pageData.topic.AdPvType==2">
                <video :src="pageData.topic.VideoSrc.replace('http:','')" playsinline webkit-playsinline x5-video-player-type="h5-page"
                       :poster="pageData.topic.VideoCover?pageData.topic.VideoCover:poster"></video>
            </div>

                <div class="backIndex" @click="GotoLiveDetail('')"></div>
                            <!--20190326去掉商业模式控制-->
                <div class="attention" @click="ShowQRCode()"></div>
        </div>
        <!-- 滚动文字 -->
        <template v-if="marqueeText.mt_isOpen">
            <div class="marquee_wrap" :class="{'marquee_flex': showFlexMarquee}"
                 :style="{background: marqueeText.mt_textBgColor}">
                <marquee class="marquee_text" :style="{color: marqueeText.mt_textColor}" scrollamount="3">{{marqueeText.mt_text}}</marquee>
            </div>
        </template>
        <div class="vzanPicture-intro">
            <div class="live-title">趣嗒嗒北京分公司开业直播</div>
            <div class="live-data d-flex">
                <div class="live-view d-flex">
                    <!-- <span class="viewCount live-status" v-if="pageData.topic.status==-1">未开始</span> -->
                    <span class="viewCount live-status" v-if="pageData.topic.status==1">直播中</span>
                    <!-- <span class="viewCount live-status" v-if="pageData.topic.status==0">回放</span> -->
                    <div class="viewCount">458浏览</div>
                </div>
                <div class="activeDetail d-flex">
                    <div class="de-word" v-on:click="introDuce(true)">活动详情</div>
                    <div class="de-arrow"></div>
                </div>
            </div>
        </div>
        <!--v-if="mbType == 1"-->
        <!-- 下滑置顶区域 start -->
        <div :class="{'ifixNav': navStatus}" class="ctrl-top-bar" style="width:100%" :style="{top:(showFlexMarquee?'28px':'0')}">
            <div class="vzanPicture-nav d-flex">
                <div class="navAll d-flex">
                    <div class="d-flex" v-if="pageData.topic" v-on:click="gainData(false)">
                        <div class="all-pic" :class="{'navInit':  hourStatus}">图片直播</div>
                        <div v-if="pageData.topic.status!=-1||(pageData.user&&pageData.user.roleId > 0)" class="all-pic" :class="{'navInit': hourStatus}">({{pageData.topic.picCount}})</div>
                        <div v-else class="all-pic" :class="{'navInit': hourStatus}">(0)</div>
                        <!-- <div v-if="pageData.topic.status!=-1||(pageData.user&&pageData.user.roleId > 0)" class="all-pic" :class="{'navInit': hourStatus}">({{pageData.topic.picCount}})</div> -->
                    </div>
                    <!-- <div class="time-btn" :class="{'timeActive': hourStatus}" </div> -->

                </div>


                <div class="nav-opeBtn d-flex">
                    <div class="sort-btn" v-on:click="sortChoice">
                        <div class="sort-active" v-show="sortStatus"></div>
                        <div class="sort-init" v-show="!sortStatus"></div>
                    </div>
                    <div class="sort-btn-c" @click="showDropDown">
                        <div class="sort-active-c"></div>
                    </div>
                </div>
            </div>
            <!-- 图片分类 -->
            <ul class="pic-type" v-if="pageData.imgclassify && pageData.imgclassify.length>0 && (pageData.topic.status!=-1||(pageData.user&&pageData.user.roleId > 0))">
                <li :class="{'active':query.typeid==0}" v-on:click="query.typeid=0;sortChoice(true)">全部图片</li>
                <li :class="{'active':query.typeid==item.Id}"
                    v-for="(item, i) in pageData.imgclassify"
                    :key="'classify'+item.id"
                    v-on:click="query.typeid=item.Id;sortChoice(true, i)"
                    :id="'class-id-' + item.Id"
                    :data-index="i">
                    {{item.title}}
                </li>
            </ul>
            <p class="class-desp"
               v-if="pageData.imgclassify && pageData.imgclassify.length"
               v-show="query.typeid != 0 && pageData.imgclassify[sortIndex].Description">
                {{pageData.imgclassify[sortIndex].Description}}
            </p>
        </div>
        <!-- 下滑置顶区域 end -->
        <!-- 新图片上传提示 -->
        <p class="wss-tip" v-if="wssTip" v-on:click="wssLoad(wssList)">有新图片上传<i v-on:click.stop="wssTip=false"></i></p>
        <!-- 4.0倒计时 -->
        <div class="count-down-4" v-if="countdownSeconds>0 && pageData.topic.status== -1 && pageData.user.roleId <= 0">
            <p class="count-down-title"></p>
            <ul class="count-down-time">
                <li id="showday">
                    <var>00</var>天
                </li>
                <li id="showhour">
                    <var>00</var>时
                </li>
                <li id="showminute">
                    <var>00</var>分
                </li>
                <li id="showsecond">
                    <var>00</var>秒
                </li>
            </ul>
        </div>

        <!-- 列表类型 -->
        <div class="img-list-type" v-show="dropdown">
            <div class="imglisttype-item nine-btn" v-on:click="picChange(3)">
                <div class="nine-active" v-show="showType == 3"></div>
                <div class="nine-init" v-show="showType != 3"></div>
                <span>宫格</span>
            </div>
            <div class="imglisttype-item four-btn" v-on:click="picChange(2)">
                <div class="four-active" v-if="!hourStatus && showType == 2"></div>
                <div class="four-init" v-else></div>
                <span>矩阵</span>
            </div>
            <div class="imglisttype-item one-btn" v-on:click="picChange(1)">
                <div class="one-active" v-show="showType == 1"></div>
                <div class="one-init" v-show="showType != 1"></div>
                <span>拼接</span>
            </div>
            <div class="imglisttype-item" v-on:click="gainData(true)">
                <!-- <div class="time-active" v-show="showType == 1"></div> -->
                <div class="time-init" :class="{act: hourStatus}"></div>
                <span>时间轴</span>
            </div>
        </div>
        <div @click.self="dropdown = false" v-show="dropdown" class="houer-mask"></div>

        <!-- 图片列表区域 -->
        <div class="vzanPicture-main">
            <!-- 图文故事 -->
            <div class="picPhoto-con d-flex is-pic-story">
                <template v-if="isPicStory && !hourStatus && showType == 2"
                          v-for="(item,index) in commonList"
                          :key="item.Id">
                    <div :class="{
                            'picPhoto':item.FilePath,
                            'cmbType': mbType == 2
                        }"
                         :id="'pic-id-' + item.Id"
                         :data-index="index"
                         :style="{ width: item.isMP, height: item.isMP === '100%' ? 'auto' : picMinHeight }">
                        <img v-if="item.FilePath"
                             :src="showType == 1 ? LiveUtil.resizeImg(item.FilePath,450,0,item.isOpenWaterMark,item.waterMarkUrl,item.waterMarkX,item.waterMarkY, 50) : LiveUtil.resizeImg(item.FilePath,450,0,item.isOpenWaterMark,item.waterMarkUrl,item.waterMarkX,item.waterMarkY, 50)"
                             v-on:click="hourStatus ? showPicDetail(0,item.indexs,item.Id,item.ptCount) : showPicDetail(0,index,item.Id)">
                        <div class="checkarea" v-show="choosePic && item.FilePath" v-on:click="hourStatus ? showPicDetail(0,item.indexs,item.Id,item.ptCount) : showPicDetail(0,index,item.Id)">
                            <div class="checkPhoto" v-show="item.user"></div>
                            <div class="initPhoto" v-show="!item.user && choosePic && item.FilePath"></div>
                        </div>
                    </div>
                    <div class="img-dsescription" v-if="item.Description">
                        <p v-if="item.DescriptionTimeStr" class="DescriptionTimeStr">
                            <span>{{item.DescriptionTimeStr}}</span>
                        </p>
                        <span>{{item.Description}}</span>
                    </div>
                </template>
            </div>
            <!-- 全部 -->
            <!-- (hourStatus||showType!=2)&& -->
            <!-- 宫格、拼接 -->
            <div class="picPhoto-con d-flex cel-three" v-if="showType!=2&&((pageData.topic && pageData.topic.status != -1) || (pageData.user && pageData.user.roleId > 0))">
                <div :class="{
                        'picPhoto':item.FilePath,
                        ' cel-three':showType == 3 && item.FilePath,
                        'one-column':showType == 1 && item.FilePath,
                        'picTime': !item.FilePath, cmbType: mbType == 2,
                    }"
                     v-for="(item,index) in commonList" :key="item.Id">
                    <div class="dayTime" v-if="item.dayTime && hourStatus">{{item.dayTime}}</div>
                    <div class="hourTime" v-if="item.hourTime && hourStatus">{{item.hourTime}}</div>
                    <img v-if="item.FilePath"
                         :src="showType == 1 ? LiveUtil.resizeImg(item.FilePath,450,0,item.isOpenWaterMark,item.waterMarkUrl,item.waterMarkX,item.waterMarkY, 50) : LiveUtil.resizeImg(item.FilePath,450,0,item.isOpenWaterMark,item.waterMarkUrl,item.waterMarkX,item.waterMarkY, 50)"
                         v-on:click="hourStatus ? showPicDetail(0,item.indexs,item.Id,item.ptCount) : showPicDetail(0,index,item.Id)">
                    <div class="checkarea" v-show="choosePic && item.FilePath" v-on:click="hourStatus ? showPicDetail(0,item.indexs,item.Id,item.ptCount) : showPicDetail(0,index,item.Id)">
                        <div class="checkPhoto" v-show="item.user"></div>
                        <div class="initPhoto" v-show="!item.user && choosePic && item.FilePath"></div>
                    </div>
                </div>
            </div>
            <!-- 矩阵 -->
            <div class="picPhoto-con d-flex waterfall" v-if="!isPicStory && !hourStatus&&showType==2&&((pageData.topic && pageData.topic.status != -1) || (pageData.user && pageData.user.roleId > 0))">
                <section>
                    <div class="picPhoto" :style="{'height':waterWidth*item.height/item.width+'px'}" v-for="(item,index) in waterFit(commonList,'left')" :key="item.Id">
                        <img v-if="item.FilePath"
                             :src="LiveUtil.resizeImg(item.FilePath,450,0,item.isOpenWaterMark,item.waterMarkUrl,item.waterMarkX,item.waterMarkY, 50)"
                             v-on:click="showPicDetail(0,item.index,item.Id,item.ptCount)">
                        <div class="checkarea" v-show="choosePic && item.FilePath" v-on:click="showPicDetail(0,item.index,item.Id,item.ptCount)">
                            <div class="checkPhoto" v-show="item.user"></div>
                            <div class="initPhoto" v-show="!item.user && choosePic && item.FilePath"></div>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="picPhoto" :style="{'height':waterWidth*item.height/item.width+'px'}" v-for="(item,index) in waterFit(commonList,'right')" :key="item.Id">
                        <img v-if="item.FilePath"
                             :src="LiveUtil.resizeImg(item.FilePath,450,0,item.isOpenWaterMark,item.waterMarkUrl,item.waterMarkX,item.waterMarkY, 50)"
                             v-on:click="showPicDetail(0,item.index,item.Id,item.ptCount)">
                        <div class="checkarea" v-show="choosePic && item.FilePath" v-on:click="showPicDetail(0,item.index,item.Id,item.ptCount)">
                            <div class="checkPhoto" v-show="item.user"></div>
                            <div class="initPhoto" v-show="!item.user && choosePic && item.FilePath"></div>
                        </div>
                    </div>
                </section>
            </div>
            <!-- 时间轴瀑布流 start -->
            <template v-for="items in waterfallList" v-if="hourStatus && showType==2 && ((pageData.topic && pageData.topic.status != -1) || (pageData.user && pageData.user.roleId > 0))">
                <div class="dayTime waterfall" v-if="items.dayTime">{{items.dayTime}}</div>
                <div class="hourTime waterfall">{{items.hourTime}}</div>
                <div class="picPhoto-con d-flex waterfall">
                    <section>
                        <div class="picPhoto" :style="{'height':waterWidth*item.height/item.width+'px'}" v-for="(item,index) in waterFit(items.img,'left')" :key="'img'+index">
                            <img v-if="item.FilePath"
                                 :src="LiveUtil.resizeImg(item.FilePath,450,0,item.isOpenWaterMark,item.waterMarkUrl,item.waterMarkX,item.waterMarkY, 50)"
                                 v-on:click="showPicDetail(0,item.indexs,item.Id,item.ptCount)">
                            <div class="checkPhoto" v-if="item.FilePath" v-show="item.user" v-on:click="showPicDetail(0,item.indexs,item.Id,item.ptCount)"></div>
                            <div class="initPhoto" v-if="item.FilePath" v-show="!item.user && choosePic && item.FilePath" v-on:click="showPicDetail(0,item.indexs,item.Id,item.ptCount)"></div>
                        </div>
                    </section>
                    <section>
                        <div class="picPhoto" :style="{'height':waterWidth*item.height/item.width+'px'}" v-for="(item,index) in waterFit(items.img,'right')" :key="'img'+index">
                            <img v-if="item.FilePath"
                                 :src="LiveUtil.resizeImg(item.FilePath,210,0,item.isOpenWaterMark,item.waterMarkUrl,item.waterMarkX,item.waterMarkY, 50)"
                                 v-on:click="showPicDetail(0,item.indexs,item.Id,item.ptCount)">
                            <div class="checkPhoto" v-if="item.FilePath" v-show="item.user" v-on:click="showPicDetail(0,item.indexs,item.Id,item.ptCount)"></div>
                            <div class="initPhoto" v-if="item.FilePath" v-show="!item.user && choosePic && item.FilePath" v-on:click="showPicDetail(0,item.indexs,item.Id,item.ptCount)"></div>
                        </div>
                    </section>
                </div>
            </template>
            <!-- 时间轴瀑布流 end -->
            <div class="loadMore" v-show="!loadStatus && (pageData.topic && pageData.topic.picCount) 
            && (pageData.topic && (pageData.topic.status != -1 || pageData.user.roleId>0))">
                <p>正在加载</p>
            </div>

            <div class="noMore" v-show="loadStatus && (pageData.topic && (pageData.topic.status != -1 || pageData.user.roleId>0)) && commonList.length > 0">
                <p>- 已经到底了哦 -</p>
            </div>
            <div class="pic-type-empty" v-if="commonList.length==0 && loadStatus">
                {{query.typeid==0?'暂无数据':'当前分类暂无图片，您可观看其他分类图片'}}
            </div>
            <div class="pic-type-empty" v-if="countdownSeconds<=0 && pageData.topic.status== -1 && pageData.user.roleId<=0">直播即将开始，别走开</div>
        </div>

        <!-- 拼图按钮 -->
        <div class="choice-footer d-flex" v-show="choosePic">
            <div class="goLive cancel" @click="choosePic = false">退出拼图</div>
            <!-- jjgsawClick -->
            <div class="goLive" :class="{'pin-pics': megicCount}" @click="showSettingCover">{{'拼图(' + megicCount + '/10)'}}</div>
        </div>

        <!-- 操作按钮 v-if="mbType != 3" -->
        <div class="vzanPicture-opeBtn" v-show="!choosePic">
            <div class="goTop-btn" v-show="navStatus" @click="backTop"></div>
            <div class="findMe-btn" @click="findMe" v-if="pageData.topic.IsFaceRecEnable"></div>
            <template v-if="pageData.topic && pageData.topic.status != -1 ">
                <div class="pt-btn" @click="ptStatus = true"></div>
            </template>
            <template v-if="pageData.topic && pageData.topic.status != -1&& IsAutoPlayMusic ">
                <div class="auto-btn" @click="showPicDetail(pageData.topic.AutoPlaySecond*1000||5000,0,0)"></div>
            </template>
            <template v-if="pageData.user && !pageData.user.roleId && pageData.topic.IsShareIcon&&pageData.topic.IsShareTopic">
                <div class="invite-btn" @click="GotoInviteCard"></div>
            </template>
            <template v-if="pageData.user && pageData.user.roleId > 0 && !issmall">
                <div class="opes-btn" @click="showPoper(true)"></div>
            </template>
        </div>

        <!-- 视频直播按钮 && mbType != 3 -->
            <template v-if="pageData.topic && pageData.topic.bindId > 0 ">
                <div class="live-btn" v-bind:class="{'hideBtn': liveBtn}" @click="GotoTvchat(pageData.topic.bindId)"></div>
            </template>
        <!-- 视频直播按钮 -->
        

        <!-- 菜单操作 -->
        <template v-if="pageData.user && pageData.user.roleId > 0">
            <div class="spoper-channel">
                <div class="channel-mask" v-show="maskStatus" v-on:click="showPoper(false)"></div>
                <div class="channel-entry" v-bind:class="{'show-channel-popers': maskStatus}">
                    <div class="channel-entry-item d-flex">
                        <template v-if="pageData.user.roleId>0 && pageData.user.roleId!=3">
                            <a href="javascript:;" v-on:click="ToEditTop()" class="entry-item-wrap d-flex">
                                <img src="https://j.vzan.cc/zhibo/livecontent/topic/images/bianji.png" alt="">
                                <p>编辑话题</p>
                            </a>
                            <a href="javascript:;" class="entry-item-wrap d-flex" v-if="!pageData.live.IsTopicCreateMsgTip && !pageData.topic.IsTestTopic" @click="PushTopic()">
                                <img src="https://j.vzan.cc/zhibo/livecontent/topic/images/tuisong.png" alt="">
                                <p>推送通知</p>
                            </a>
                            <template v-if="pageData.topic.RelayId==0">
                                <a href="javascript:;" v-on:click="ToInviteGuest()" class="entry-item-wrap d-flex" v-if="pageData.user.roleId!=3">
                                    <img src="https://j.vzan.cc/zhibo/livecontent/topic/images/jiabing.png" alt="">
                                    <p>邀请嘉宾</p>
                                </a>
                                <a href="javascript:;" v-on:click="InviteTopAdmin()" class="entry-item-wrap d-flex" v-if="pageData.user.roleId==1||pageData.user.roleId==2">
                                    <img src="https://j.vzan.cc/zhibo/livecontent/topic/images/tpadmin.png" alt="">
                                    <p>邀请管理员</p>
                                </a>
                                <a href="javascript:;" class="entry-item-wrap d-flex" v-if="pageData.topic.status==-1" @click="BeginPicTopic()">
                                    <img src="https://j.vzan.cc/zhibo/livecontent/topic/images/startLive.png" alt="">
                                    <p>开始直播</p>
                                </a>
                                <a href="javascript:;" class="entry-item-wrap d-flex" v-else-if="pageData.topic.status!=0" @click="EndPicTopic">
                                    <img src="https://j.vzan.cc/zhibo/livecontent/topic/images/endLive.png" alt="">
                                    <p>结束直播</p>
                                </a>
                            </template>
                        </template>
                            <a href="javascript:;" v-on:click="ToImgManage()" class="entry-item-wrap d-flex" v-if="pageData.user.roleId > 0&&pageData.topic.RelayId==0">
                                <img src="https://j.vzan.cc/zhibo/livecontent/topic/images/managePic.png" alt="">
                                <p>图片管理</p>
                            </a>
                        <a href="javascript:;" v-on:click="gotoPicStoryMgr('False'==='True')" class="entry-item-wrap d-flex" v-if="pageData.topic.RelayId==0 && [1,2,11,14,15].indexOf(pageData.user.roleId)!= -1">
                            <img src="https://j.vzan.cc/zhibo/livecontent/topic/images/img-article-icon.png" alt="">
                            <p>图文故事</p>
                        </a>
                            <a href="javascript:;" class="entry-item-wrap d-flex" @click="GotoInviteCard">
                                <img src="https://j.vzan.cc/zhibo/livecontent/topic/images/inviteCard.png" alt="">
                                <p>邀请卡</p>
                            </a>
                    </div>
                    <div class="channel-entry-close" v-on:click="showPoper(false)">关闭</div>
                </div>
            </div>
        </template>

        <!-- 分享遮罩 -->
        <div class="share-Mask" v-show="shareStatus">
            <div class="share-img">
                <img src="https://j.vzan.cc/zhibo/livecontent/topic/image/ac-tip.png" alt="" />
            </div>
            <div class="know-img" v-on:click="hideShare">
                <img src="https://j.vzan.cc/zhibo/livecontent/topic/image/know.png" alt="" />
            </div>
        </div>

        <!-- 活动介绍 -->
        <div class="active-int">
            <div class="active-int-mask" v-show="introStatus" v-on:click="introDuce(false)" @touchmove.prevent></div>
            <div class="active-int-entry" :class="{'showEntry' : introStatus}">
                <div class="intro-title">
                    <div class="close-img" v-on:click="introDuce(false)">
                        <img src="https://j.vzan.cc/zhibo/livecontent/topic/image/s-close.png" alt="" />
                    </div>
                </div>
                <div class="active-int-content">
                    <div class="intro-data">
                        <div class="intro-dataCon d-flex">
                            <div class="intro-dataCon-img">
                                <img src="https://j.vzan.cc/zhibo/livecontent/topic/image/int-name.png" alt="" />
                            </div>
                            <div class="intro-dataCon-word">直播名称：趣嗒嗒北京分公司开业直播</div>
                        </div>
                        <div class="intro-dataCon d-flex">
                            <div class="intro-dataCon-img">
                                <img src="https://j.vzan.cc/zhibo/livecontent/topic/image/int-time.png" alt="" />
                            </div>
                            <div class="intro-dataCon-word">开始时间：2019-08-18 14:16:39</div>
                        </div>
                        <template v-if="pageData.topic">
                            <div class="intro-dataCon d-flex" v-if="pageData.topic.PicAddress">
                                <div class="intro-dataCon-img">
                                    <img src="https://j.vzan.cc/zhibo/livecontent/topic/image/int-address.png" alt="">
                                </div>
                                <div class="intro-dataCon-word">活动地点：</div>
                            </div>
                        </template>
                    </div>
                    <div class="intro-main" v-if="tpremark!=''">
                        <div class="intro-main-title">活动介绍</div>
                        <!-- <div class="intro-main-word tpremarkImg" v-html="tpremark"></div> -->
                        <div class="intro-main-word" v-html="tpremark"></div>
                    </div>
                </div>
                <p style="text-align:center;">
                    <a class="Complaint" v-on:click="IsComplaint()">举报反馈</a>
                </p>

            </div>
        </div>

        <!-- 图片详情 -->
        <div class="picDetail-poper" v-show="picDetail">
            <div class="picDetail-main d-flex">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                    </div>
                </div>
            </div>
            <div v-if="userData&&imgUploaduser" class="user-area">
                <img src="/livecontent/img/info-img.png" @click="userInfoShow = true" />
            </div>
            <div class="user-data-show" @click="userInfoShow = false" v-show="userInfoShow">
                <div class="usd-content" v-if="userData">
                    <img class="usd-cover" :src="userData.user.headimgurl" />
                    <p class="usd-live-name">{{userData.user.nickname}}</p>
                    <p class="usd-wir">摄影师</p>
                </div>
            </div>
            <div class="picDetail-footer d-flex" v-if="userData">
                <ul class="save-area">
                    <li v-if="activePic&&pageData.topic.IsOpenImgDownload">
                        <span v-on:click="lookOriginal">{{picWord + LiveUtil.sizeConverter(activePic.FileSize)}}</span>
                        <i>长按保存图片</i>
                    </li>
                    <li v-if="!(activePic&&pageData.topic.IsOpenImgDownload)">
                        <i v-if="!isOpenShang && !(pageData.topic.IsShareIcon&&pageData.topic.IsShareTopic)">长按保存图片</i>
                    </li>
                </ul>
                <ul class="picDetail-footer-ope d-flex" :class="{'around':!pageData.topic.IsFaceRecEnable, 'only-zan-btn': (!isOpenShang && !(pageData.topic.IsShareIcon&&pageData.topic.IsShareTopic) && !(pageData.topic.IsFaceRecEnable&&userData&&userData.FaceRecStatus!=0)) }">
                    
                    <template v-if="userData&&userData.IsFaceRecEnable&&userData.FaceRecStatus!=0">
                        <li class="face-btn none" v-if="userData.FaceRecStatus==-1">系统识别中</li>
                        <template v-else>
                            <li class="face-btn" v-show="userData.FaceImages.length>0" v-on:click="showFaceList=true">
                                智能引擎已检索到{{userData.FaceImages.length}}张人脸
                            </li>
                            <li class="face-btn none" v-show="userData.FaceImages.length==0">
                                未检测到人脸
                            </li>
                        </template>
                    </template>
                    <li v-if="isOpenShang" class="picDetail-ope-item" v-on:click="rewardUser">
                        <img src="https://j.vzan.cc/zhibo/livecontent/topic/picicon/reward.png">
                        <p>打赏</p>
                    </li>
                    <li class="picDetail-ope-item" v-on:click="showShareStyle=true" v-if="pageData.topic.IsShareIcon&&pageData.topic.IsShareTopic">
                        <img src="https://j.vzan.cc/zhibo/livecontent/topic/picicon/share.png">
                        <p>分享</p>
                    </li>
                    <li class="picDetail-ope-item" v-on:click="userData.isPraise?null:clickZan()">
                        <img src="https://j.vzan.cc/zhibo/livecontent/topic/picicon/zan0.png" v-show="!userData.isPraise">
                        <img src="https://j.vzan.cc/zhibo/livecontent/topic/picicon/zan1.png" v-show="userData.isPraise">
                        <p>{{LiveUtil.numberConvert(userData.ZanCount)}}</p>
                    </li>
                </ul>
            </div>
            <span class="img-list-len" v-if="pageData.topic">{{swiperIndex+ '/' + imgCount}}</span>
            <div class="picDetail-main-close"
                 style='border-radius:50%'>
                <i class="close-btn" v-on:click="hidePicDetail"></i>
            </div>
            <!-- 人像识别弹窗 -->
            <div class="shadow" v-if="showFaceList" v-on:click="showFaceList=false"></div>
            <div class="face-style" :class="{'show':showFaceList}" v-if="userData">
                <h1>识别到{{userData.FaceImages.length}}张人脸</h1>
                <i v-on:click="showFaceList=false"></i>
                <div class="face-list">
                    <img v-for="(img,index) in userData.FaceImages" v-on:click="faceResult" :src="img" :key="'face'+img">
                </div>
            </div>
            <!-- 分享样式选择 -->
            <div class="shadow" v-if="showShareStyle" v-on:click="showShareStyle=false"></div>
            <div class="share-style" :class="{'show':showShareStyle}">
                <p class="share-style-title">请选择分享样式</p>
                <ul class="share-style-list">
                    <li v-for="(item,index) in shareStyleData"
                        :class="[index==shareStyleId?'active':'',item.className]" v-on:click="shareStyleId=index">{{item.name}}</li>
                </ul>
                <div class="share-style-input">
                    <span>文案</span>
                    <input type="text" v-model="shareTitle" maxlength="30">
                </div>
                <div class="share-btn-group">
                    <p class="close" v-on:click="showShareStyle=false">取消</p>
                    <P v-on:click="showShareStyle=false;sharePic(true)">确定</P>
                </div>
            </div>
            <!-- 分享的图片 -->
            <div class="sharePic" v-show="detailStatus">
                <div class="sharePic-close" v-on:click="sharePic(false)"></div>
                <div class="sharePic-container">
                    <img class="shareImg" :src="shareImgUrl">
                </div>
                <div class="sharePic-tips">长按保存到手机</div>

            </div>
        </div>

        <!-- 拼图完成页面 -->
        <div class="jjgsaw-poper" v-show="jjgsaw">
            <div class="jjgsaw-tips">
                <span @click="closeJjgsaw">取消</span>
                <span @click="renderCover">{{coverFinish?'长按保存图片':'完成'}}</span>
            </div>
            <div class="jjgsaw-container" ref="jjgsaw">
                <div class="jjgsaw" :style="(coverheight <= 680 ? 'display: flex;align-items: center;':'')">
                    <img @load="reloadHeight" v-show="coverFinish" class="jjgsawImg" style="display: none;" src="" />
                    <div v-show="!coverFinish" class='pt-preview'>
                        <div class="pingjie" v-if="ptType == 1">
                            <div :style="{ padding: ptPadding + 'px ' }"
                                 v-for="(v, i) in megicList">
                                <img @load="reloadHeight" :src="v.FilePath" />
                            </div>
                        </div>
                        <div class="gongge" v-if="ptType == 2">
                            <img @load="reloadHeight" class="w50p" :style="{height: picMinHeight}" v-for="(v, i) in megicList" :src="v.FilePath" />
                        </div>
                        <div class="cover-info">
                            <div class="info-wrap">
                                <div class="cover-info-left">
                                    <div class="cover-title ellipsis2">{{joinpicTitle}}</div>
                                    <div class="info-small">
                                        <p v-if="!showLocalTime">
                                            <img class="cover-info-img-date" src="../../livecontent/topic/images/share-icon-date.png" alt="">
                                            <span>{{pageData.topic.starttime}}</span>
                                        </p>
                                        <p v-if="!showLocalTime && pageData.topic.PicAddress">
                                            <img class="cover-info-img-address" src="../../livecontent/topic/images/share-icon-address.png" alt="">
                                            <span>{{pageData.topic.PicAddress}}</span>
                                        </p>
                                        <p v-if="showLocalTime">长按图片扫码观看直播</p>
                                    </div>

                                </div>
                                <div class="cover-qrcode">
                                    <img id="cover-qrcode" src="" alt="">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div v-show="!coverFinish" class="set-bar-pt" v-show="ptType !== 3">
                <div class="set-bar-item" @click="setCover('title')">
                    <img src="https://j.vzan.cc/zhibo/livecontent/topic/images/title-icon.png" alt="" class="set-bar-icon">
                    <span class="set-text">标题</span>
                </div>
                <div v-show="ptType !== 2" class="set-bar-item" @click="setCover('padding')">
                    <img src="https://j.vzan.cc/zhibo/livecontent/topic/images/padding-icon.png" alt="" class="set-bar-icon">
                    <span class="set-text">边框</span>
                </div>
                <div class="set-bar-item" @click="setCover('style')">
                    <img src="https://j.vzan.cc/zhibo/livecontent/topic/images/style-icon.png" alt="" class="set-bar-icon">
                    <span class="set-text">背景</span>
                </div>
            </div>
            <!-- 编辑拼图信息 -->
            <div class="pupop-shadow-set" @click.self="showPtSetting = false" v-show="showPtSetting">
                <div class="wrap-center-pss">
                    <div class="title">{{ptSetting === 'title' ?  '标题': ptSetting === 'padding' ? '边框':'背景'}}</div>
                    <!-- 标题 -->
                    <div class="set-title" v-show="ptSetting === 'title'">
                        <textarea v-model="joinpicTitle"></textarea>
                        <label for="weuiAgree" class="weui-agree">
                            <input v-model="showLocalTime" id="weuiAgree" type="checkbox" class="weui-agree__checkbox">
                            <span class="weui-agree__text">不显示时间地点</span>
                        </label>
                    </div>
                    <!-- 边框 -->
                    <div class="set-poaddin" v-show="ptSetting === 'padding'">
                        <input type="range" @input="sliderInput" id="padding-slider" min="0" max="20" value="0" />
                        <span></span>
                    </div>
                    <!-- 背景 -->
                    <div class="set-background" v-show="ptSetting === 'style'">
                        <div :class="{acti: ptStlye === 'default'}" class="bg-item" @click="ptStlye = 'default'">默认</div>
                        <div :class="{acti: ptStlye === 'happy'}" class="bg-item" @click="ptStlye = 'happy'">喜庆</div>
                        <div :class="{acti: ptStlye === 'business'}" class="bg-item" @click="ptStlye = 'business'">商务</div>
                        <div :class="{acti: ptStlye === 'fresh'}" class="bg-item" @click="ptStlye = 'fresh'">清新</div>
                        <div :class="{acti: ptStlye === 'pink'}" class="bg-item" @click="ptStlye = 'pink'">粉红</div>
                    </div>
                    <div class="btn-save" @click="settingCover">确定</div>
                </div>
            </div>
        </div>
        <!-- 选择拼图类型 -->
        <div class="choicePt" v-show="ptStatus">
            <div class="choicePt-mask" v-on:click="ptStatus = false"></div>
            <div class="choicePt-entry">
                <p class="choicePt-title">请选择拼图样式</p>
                <div class="choicePt-all d-flex">
                    <div class="choicePt-item d-flex" v-on:click="choiceType(1)">
                        <div class="hb-img">
                            <img src="https://j.vzan.cc/zhibo/livecontent/topic/images/list-icon.png" alt="">
                        </div>
                        <p class="hb-title">拼接</p>
                    </div>
                    <div class="choicePt-item d-flex" v-on:click="choiceType(2)">
                        <div class="ct-img">
                            <img src="https://j.vzan.cc/zhibo/livecontent/topic/images/cell-icon.png" alt="">
                        </div>
                        <p class="ct-title">宫格</p>
                    </div>
                    <div class="choicePt-item d-flex" v-on:click="choiceType(3)">
                        <div class="ct-img">
                            <img src="https://j.vzan.cc/zhibo/livecontent/topic/images/gif-icon.png" alt="">
                        </div>
                        <p class="ct-title">动图</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    

<link rel="stylesheet" href="https://j.vzan.cc/zhibo/livecontent/reward/css/rewardUser.css?ver=637046605863177993">
<script src="https://j.vzan.cc/zhibo/livecontent/public/js/pay.js?v=6370466058631779932019082016"></script>

<!-- 服务声明 -->
<div class="buy_tips_box">
    <div class="buy_tips_con">
        <h2>服务声明</h2>
        <p>您好，直播打赏须理性，打赏是用户自愿赠与主播/管理员的虚拟商品，且直播打赏为用户自愿支付行为。支付完成后，除因法定情形规定或者违反其他相关规定的情况外，支付金额不支持退款或者兑换。</p>
    </div>
</div>
<div class="shang-container" hidden>
    <div class="shang-container-mask" v-show="isReward"></div>
    <div class="shang-container-entry" v-show="isReward">
        <div class="entry-main">
            <img src="https://j.vzan.cc/zhibo/livecontent/reward/images/shang-c.png" alt="" class="close-shang" @click="isReward=false;otherMoeny=false;">
            <p class="entry-main-title">红包打赏给</p>
            <div class="entry-main-face d-flex">
                <div class="face-left" v-if="RewardUserList && RewardUserList.length>1">
                    <img src="https://j.vzan.cc/zhibo/livecontent/reward/images/shang-l.png" alt="">
                </div>
                <div class="face-photo">
                    <img v-if="RewardUser" :src="LiveUtil.resizeImg(RewardUser.headimgurl || RewardUser.HeadImgUrl,200,200)" alt="">
                </div>
                <div class="face-right" v-if="RewardUserList && RewardUserList.length>1">
                    <img src="https://j.vzan.cc/zhibo/livecontent/reward/images/shang-r.png" alt="">
                </div>
            </div>
            <template v-if="RewardUser">
                <div class="entry-main-data d-flex">
                    <div class="data-status" v-if="RewardUser.roleName!='自己'">{{RewardUser.roleName || "用户"}}</div>
                    <div class="data-name">{{RewardUser.nickname || RewardUser.NickName}}</div>
                </div>
                <p class="entry-main-tips" v-if="RewardWord">{{RewardWord}}</p>
                <p class="entry-main-tips" v-else>打赏榜上有名，赏金额会送给{{RewardUser.roleName || "用户"}}</p>
            </template>
            <div class="declaration">服务声明</div>
            <div class="entry-main-money d-flex">
                <template v-if="RewardMoneyList && RewardMoneyList.length>0">
                    <div v-for="item in RewardMoneyList" class="money-num" @click="Reward(LiveUtil.moneyConvertFloat(item))">{{LiveUtil.moneyConvertFloat(item)}}元</div>
                </template>
                <template v-else>
                    <div class="money-num" @click="Reward(1)">1元</div>
                    <div class="money-num" @click="Reward(2)">2元</div>
                    <div class="money-num" @click="Reward(5)">5元</div>
                    <div class="money-num" @click="Reward(10)">10元</div>
                    <div class="money-num" @click="Reward(50)">50元</div>
                    <div class="money-num" @click="Reward(100)">100元</div>
                </template>
            </div>
            <p class="other-money-num" @click="otherMoeny=true;">其他金额</p>
        </div>
    </div>

    <div class="cash" v-show="otherMoeny">
        <div class="cash-entry">
            <p class="cash-entry-title">其他金额</p>
            <div class="cash-kuan d-flex">
                <div class="number-kuan">
                    <input id="rewardMoeny" type="number" placeholder="0.1-999">
                </div>
                <span>元</span>
            </div>
            <div class="cash-entry-ope d-flex">
                <div class="entry-ope-item" @click="otherMoeny=false;">取消</div>
                <div class="entry-ope-item entry-ope-sure" @click="Reward($('#rewardMoeny').val())">确定</div>
            </div>
        </div>
    </div>
</div>
<script>
    function InitReward(zbId, tpId, userId, ele) {
        zbId = zbId || 0;
        tpId = tpId || 0;
        userId = userId || -1;
        var rewardVue = new Vue({
            el: ".shang-container",
            data: {
                zbId: zbId,
                tpId: tpId,
                RewardUserIndex: 0,
                RewardUserList: [],
                RewardMoneyList: [],
                RewardWord: "",
                otherMoeny: false,
                isReward: false
            },
            computed: {
                RewardUser: function () {
                    if (this.RewardUserList && this.RewardUserList.length > 0) {
                        return this.RewardUserList[this.RewardUserIndex];
                    }
                    return null;
                }
            },
            methods: {
                LoadRewardMoneyList: function () {
                    var that = this;
                    if (!that.RewardMoneyList || that.RewardMoneyList.length == 0) {
                        $.post("/liveajax/GetRewardList", { zbId: that.zbId, tpId: that.tpId }, function (result) {
                            if (result) {
                                if (result.dataObj) {
                                    that.RewardMoneyList = result.dataObj;
                                }
                                that.RewardWord = result.Msg;
                            }
                        });
                    }
                },
                LoadRewardUserList: function () {
                    var that = this;
                    if (userId < 0)
                        return;
                    if (!that.RewardUserList || that.RewardUserList.length == 0) {
                        $.post("/liveajax/GetRewardUserList", { tpId: tpId, userId: userId }, function (result) {
                            if (result && result.dataObj && result.dataObj.length > 0) {
                                that.RewardUserList = result.dataObj;
                            }
                        });
                    }
                },
                showReward: function () {
                    var that = this;
                    that.isReward = true;
                },
                LastUser: function () {
                    var that = this;
                    if (that.RewardUserIndex > 0) {
                        that.RewardUserIndex--;
                    }
                },
                NextUser: function () {
                    var that = this;
                    if (that.RewardUserIndex < that.RewardUserList.length - 1) {
                        that.RewardUserIndex++;
                    }
                },
                SetUser: function (user) {
                    var that = this;
                    that.RewardUserList = [user];
                    console.log(that.RewardUserList);
                    that.showReward();
                },
                Reward: function (money) {
                    var that = this;
                    money = Math.ceil(money * 100);
                    if (isNaN(money)) {
                        layer.msg("请输入正确的金额");
                        return false;
                    }
                    if (money < 10) {
                        layer.msg("打赏金额不能少于0.1元");
                        return false;
                    }
                    if (money > 99900) {
                        layer.msg("打赏金额不能大于999元");
                        return false;
                    }
                    if (!that.RewardUser) {
                        layer.msg("打赏用户不明确！");
                        return;
                    }
                    var params = {
                        zbId: that.zbId,
                        tpId: that.tpId,
                        toUserId: that.RewardUser.Id || that.RewardUser.UserId,
                        ordertype: "Reward",
                        payfei: money
                    };
                    payment(params, function (result) {
                        that.isReward = false;
                        that.otherMoeny = false;
                    });
                }
            },
            created: function () {
                var that = this;
                setTimeout(function () {
                    that.LoadRewardMoneyList();
                    that.LoadRewardUserList();
                }, 3500);
            },
            mounted: function () {
                this.$nextTick(function () {
                    $(".shang-container").show();
                })
            }
        });
        if (ele) {
            $(document).on("click", ele, function () {
                rewardVue.showReward();
            });
        }
        return rewardVue;
    }

    $(document).ready(function () {
        // 显示服务声明
        $('.declaration').on('click', function () {
            $('.buy_tips_box').show();
        })
        // 隐藏服务声明
        $('.buy_tips_box').on('click', function () {
            $(this).hide();
        })
    })
</script>
    <script src="https://j.vzan.cc/zhibo/livecontent/plugin/jquery.qrcode.min.js?ver=637046605863177993"></script>
    <script src="https://j.vzan.cc/zhibo/livecontent/plugin/swiper-4.4.1/js/swiper.js?ver=637046605863177993"></script>
    <script src="https://j.vzan.cc/zhibo/livecontent/weddingNew/js/weui.min.js?ver=637046605863177993"></script>
    <script src="https://j.vzan.cc/zhibo/livecontent/public/popup/popup.js?ver=637046605863177993"></script>
    <script src="https://j.vzan.cc/zhibo/livecontent/public/js/scrollreveal3.4.0.js?ver=637046605863177993"></script>
    <script src="https://j.vzan.cc/zhibo/livecontent/plugin/video2019/video2019.js?ver=637046605863177993637047595925147615"></script>
    <script src="https://cdn.bootcss.com/vConsole/3.3.0/vconsole.min.js"></script>
    <script>
        $(document).on('click', 'img',function(e) {
            e.preventDefault()
        })
        var rewardVue = InitReward(733664,1935643604);
        var small = 0;
        var app = new Vue({
            el: '.vzanPicture',
            data: function () {
                return {
                    // 是否可以编辑
                    isModifyTw: false,
                    picBigHeight: parseInt(document.documentElement.offsetWidth) + 'px',
                    picMinHeight: parseInt(document.documentElement.offsetWidth /2) + 'px',
                    // 皮肤
                    skintype: 'fashiongold',
                    currentMinPicCount: 0,
                    isPicStory: 'False' === 'True', // 是否开启图文故事
                    QrPopType: 1,
                    ImgQrcodeInfo: {
                        IsLookOpenImgQrcode: false,
                        LookOpenImgQrcodeName: "",
                        LookOpenImgQrcode: ""
                    },
                    isPageLoading: true,
                    zbId: parseInt('733664'),
                    tpId: parseInt('1935643604'),
                    pageData: { topic: '', live: '', user: '' },
                    shareuid: LiveUtil.getQueryString("shareuid") || 0,
                    dataList: [], // 全部图片数据
                    query: {
                        zbId:733664, tpId:1935643604, state: 1, page: 1, limit: 48, sort: "Sort", order: "asc", types: "All",typeid:'0'
                    },
                    isLoading: false,//图片列表是否正在加载
                    isNoMore: false,
                    maskStatus: false,
                    countdownSeconds:-3024993.5147615,
                    isOpenShang:true,
                    IsAutoPlayMusic:true,
                    shareStatus: false, // 分享弹窗状态
                    navStatus: false, // 导航栏状态
                    introStatus: false, //直播介绍状态
                    sortStatus: false, // 是否正倒序
                    sortIndex: 0,
                    hourStatus: false, // 按小时查看
                    commonList: [], // 处理后的图片数据
                    detailStatus: false, // 图片分享状态
                    shareInfo: '', //图片分享的资料
                    shareImgUrl: '', //分享成功的图片
                    picDetail: false, // 图片细节状态
                    mySwiper: '',  // 初始化的swiper实例
                    swiperIndex: 0,
                    activeIndex: -1,
                    picWord: '查看原图',
                    loading: '',
                    playMusic: 'false',
                    musicStatus: false,
                    layers: '',
                    userData: null, // 摄影师数据
                    choosePic: false, // 拼图状态
                    megicList: [], //拼图图片数组
                    jjgsaw: false, //拼图页面展示
                    //ptType: 0, // 拼图类型 1海报，2长图
                    ptStatus: false, // 拼图显示隐藏状态
                    ptType: 0,
                    mbType: 1, // 模板风格
                    loadStatus: false,
                    showType: 2, //四宫格为2，一宫格为1，九宫格为3
                    count: -1, // 天数图片数据的索引
                    ptCount: -1, // 天数数据的拼图索引
                    scrollReveal: ScrollReveal(),
                    liveBtn: false,
                    activeColor: '', //拼图的背景色
                    IsimgViewCount:'false',
                    tpremark: '',
                    issmall: small > 0,
                    isSiteCreator : 'false',
                    topIsUnable: false,
                    imgUploaduser:true,
                    //4.0新增
                    showShareStyle:false, //是否显示分享样式弹窗
                    shareStyleId:0, //当前选中的分享样式
                    shareTitle:'',//分享时填写的标题
                    joinpicTitle:'',//拼图要修改的标题，同上，初始化为原话题的标题
                    joinpicMode:'',//拼图模式 1长图 2宫格 3海报
                    shareStyleData:[//分享样式数据，用于生成分享图
                        {
                            className:'',//样式
                            name:'默认',//名称
                            title:'#0084FF',//分享卡标题颜色
                            text:'#353535',//分享卡其他字体颜色
                            bg:'../../livecontent/topic/images/share-bg-default.png'//分享卡背景图
                        },
                        {
                            className:'happy',
                            name:'喜庆',
                            title:'#FFA800',
                            text:'#FFFFFF',
                            bg:'../../livecontent/topic/images/share-bg-happy.png'
                        },
                        {
                            className:'business',
                            name:'商务',
                            title:'#FFFFFE',
                            text:'#FFFFFF',
                            bg:'../../livecontent/topic/images/share-bg-business.png'
                        },
                        {
                            className:'fresh',
                            name:'清新',
                            title:'#6BB519',
                            text:'#353535',
                            bg:'../../livecontent/topic/images/share-bg-fresh.png'
                        },
                        {
                            className:'pink',
                            name:'粉红',
                            title:'#FE4161',
                            text:'#353535',
                            bg:'../../livecontent/topic/images/share-bg-pink.png'
                        },
                        {
                            className:'fashion',
                            name:'时尚',
                            title:'#DBB76C',
                            text:'#FFFFFF',
                            bg:'../../livecontent/topic/images/share-bg-fashion.png'
                        }
                    ],
                    joinImgList:[],//拼图选择生成的图片列表
                    wssTip:false,//图片上传更新提示
                    wssList:[],  //图片更新缓存数据
                    wssImgclassify:'', //图片更新图片分类数据
                    wssCount:'',

                    // 拼图优化  拼图设置
                    showPtSetting: false,
                    ptSetting: 'title',
                    // 拼图风格
                    ptStlye: 'default',
                    // 拼图海报 是否显示时间地点
                    showLocalTime: false,
                    ptPadding: 0,
                    dropdown: false,
                    coverheight: 667,
                    gifHeight: 0,
                    ptMaxWidth: 840,
                    coverFinish: false,

                    waterWidth:0, //瀑布流宽度
                    poster:'https://i2cut.vzan.cc/image/liveimg/jpeg/2019/8/18/141459091ea87846f54fac810bdc58bde2110b.jpeg?imageView2/1/w/1280/h/720/q/90',//话题封面
                    showFaceList:false, //显示识别到的人脸列表
                    userInfoShow: false, // 是否显示用户信息
                    showFlexMarquee: false, // 是否在顶部
                    marqueeText: { // 滚动文字数据
                        mt_isOpen: false, // 是否开启
                        mt_isLocation: 2, // 显示位置（2-视频下方，1-滚动固定顶部）
                        mt_text: '', // 文字内容
                        mt_textColor: '#814000', // 文字颜色
                        mt_textBgColor: '#ffeabd', // 背景颜色
                    },
                    bit: 1.74,
                }
            },
            watch: {
                ptStlye: function (n) {
                    var dateIconUrl = '../../livecontent/topic/images/share-icon-date'+ ((n == 'business' || n === 'happy') ? '-w':'') +'.png'
                    var addressIconUrl = '../../livecontent/topic/images/share-icon-address'+ ((n == 'business' || n === 'happy') ? '-w':'') +'.png'

                    $('.cover-info-img-date').attr('src', dateIconUrl);
                    $('.cover-info-img-address').attr('src', addressIconUrl);

                    var qcolor = (n == 'business' || n === 'happy') ? '#ffffff':'#747474';

                    $('.info-small p').css('color', qcolor);


                    var tcolor = n == 'business' ? '#FFA800' : n === 'happy' ? '#DBB76C' : n === 'fresh' ? '#6BB519' : n === 'pink' ? '#FE4161' : '#353535';
                    $('.cover-title').css('color', tcolor);

                    // 信息背景快
                    if (n !== 'business' && n !== 'happy') {
                        var fillRoundRectBgColor = n === 'pink' ? '#FFECEF' : n === 'fresh' ? 'rgba(107, 181, 25, 0.3)' : 'rgba(245, 246, 247, 1)'
                        $('.info-wrap').css('backgroundColor', fillRoundRectBgColor)
                        $('.info-wrap').css('backgroundImage', '');
                    } else {
                        if (n === 'business') {
                            $('.info-wrap').css('backgroundImage', 'url(../../livecontent/topic/images/business-bg.png)');
                        }
                        else if (n === 'happy') {
                            $('.info-wrap').css('backgroundImage', 'url(../../livecontent/topic/images/happy-bg.png)');
                        }
                    }

                    if (n == 'fresh') {
                        var fbg = '../../livecontent/topic/images/fresh-bg.png'
                        $('.info-wrap').css('backgroundImage', '');
                        $('.cover-info').css('backgroundImage', 'url('+fbg+')');
                    } else {
                        $('.cover-info').css('backgroundImage', '');
                    }

                    // 背景
                    var bg = n === 'happy' ? '#FF1732' : n === 'business' ? '#262626' : '#fff';
                    $('.pt-preview').css('backgroundColor', bg);
                }
            },
            computed: {
                activePic: function () {
                    return this.dataList[this.activeIndex];
                },
                megicCount: function () {
                    return this.megicList.length
                },
                waterfallList:function(){ //瀑布流数据
                    if(!this.hourStatus){
                        return this.commonList;
                    }
                    var list=[],len=-1;
                    this.commonList.forEach(function(item){
                        if(item.dayTime){
                            len++;
                            list[len]={};list[len].img=[];
                            list[len].dayTime=item.dayTime;
                        }
                        if(item.hourTime){
                            if(list[len].hourTime){
                                len++;
                                list[len]={};list[len].img=[];
                            }
                            list[len].hourTime=item.hourTime;
                        }
                        if(item.Id)
                        list[len].img.push(item)
                    })
                    return list;
                },
                imgCount:function(){//显示图片数量上限，保证查看各个分类图片详情下显示各自的总数
                    if(this.query.typeid==0)
                    return this.pageData.topic.picCount;
                    var count;
                    this.pageData.imgclassify.forEach(function(item){
                        if(item.Id==this.query.typeid){
                            return count=item.imgcount;
                        }
                    }.bind(this))
                    return count;
                }
            },
            methods: {
                reloadHeight: function () {
                    this.coverheight = $('.pt-preview').height();
                },
                // 编辑图文故事
                toModifyTw: function () {
                    if (this.isModifyTw) {
                        location.href = '/live/PicStoryModify?zbid='+ this.zbId +'&tpid=' + this.tpId+'&v='+(+new Date());
                    }
                },
                showDropDown: function () {
                    var offset = $('.sort-btn-c').offset();
                    $('.img-list-type').css({
                        top: $('.ctrl-top-bar').get(0).getBoundingClientRect().top + 40,
                        left: offset.left - 50
                    });
                    this.dropdown = true;
                },
                // 更新海波封面
                settingCover: function () {
                    if (this.ptSetting === 'title') {
                        if (this.joinpicTitle.length > 30) {
                            layer.msg('标题最长为30个字！');
                            this.joinpicTitle = this.joinpicTitle.substr(0, 30);
                            return
                        }
                    }
                    this.showPtSetting = false;
                },
                // 显示编辑信息
                setCover: function (fg) {
                    // 编辑类型
                    this.ptSetting = fg;
                    // 显示编辑框
                    this.showPtSetting = true;
                },
                // 滑块输入
                sliderInput: function (e) {
                    var value = e.target.value;
                    var pre = (value / 20) * 100;
                    $('#padding-slider').css('backgroundSize', pre + '% 100%');
                    $('.set-poaddin').find('span').text(value);
                    this.ptPadding = value;
                },
                // 显示拼图设置
                showSettingCover: function () {
                    $('#cover-qrcode').attr('src', $("#QRCode").find("canvas").get(0).toDataURL('image/jpeg'));
                    var that = this
                    if (!this.megicCount) {
                        layer.msg('请选择你的图片！')
                        return
                    }
                    // 宫格
                    if (this.ptType === 2 ) {
                        if (this.megicCount % 2 === 1) {
                            layer.msg('图片数量不能为奇数')
                            return
                        }
                    }
                    if (this.ptType === 3) {
                        if (this.megicCount < 2) {
                            layer.msg('请至少选择2张图片！')
                            return
                        }
                    }
                    if (this.megicCount > 10) {
                        layer.msg('图片数量不能大于10张')
                        return
                    }
                    $('.jjgsawImg').attr('src', '');
                    this.jjgsaw = true;
                    if (this.ptType === 3) {
                        this.loading = weui.loading('正在拼图中');
                        this.joinpicGIF();// 动图
                        this.coverFinish = true;
                    } else {
                        this.$nextTick(function () {
                            that.coverheight = $('.pt-preview').height();
                        })
                    }
                },
                GotoTvchat: function (tpId) {   //跳转话题播放页
                    GotoTvChat(tpId, this.shareuid);
                },
                GotoInviteCard: function () {   //跳转邀请卡界面
                    location.href = "/live/NewInviteCard-" + this.zbId + "?topicId=" + this.tpId + "&type=topic";
                },
                GotoLiveDetail: function (url) {   //跳转直播间首页
                    if (url) {
                        location.href = url;
                    } else {
                        GotoLiveDetail(this.zbId, this.shareuid);
                    }
                },
                GotoLiveIntroduce: function () {    //跳转话题介绍页
                    GotoLiveIntroduce(this.tpId, this.shareuid);
                },
                GotoPicIntroduce: function () {    //跳转图片直播介绍页
                    window.location.href = "/live/topicpicIntroduce?tpid=" + this.tpId + "&v=" + new Date().getTime() + (this.shareuid > 0 ? "&shareuid=" + this.shareuid : "");
                },
                GotoManage: function () {
                    location.href = "/live/topicpicmanage?tpid=" + this.tpId + "&v=" + new Date().getTime();
                },
                // 关闭海报时，清空选项
                choiceType: function (num) {
                    if(this.commonList.length == 0)
                        return layer.msg('当前分类暂无图片，你可以选择其他分类进行拼图')
                    if (num) {
                        this.ptType = num;
                    }
                    this.ptStatus = false;
                    this.choosePic = true;
                    this.megicList = [];
                    var list = this.commonList;
                    for (var index = 0; index < list.length; index++) {
                        var item = list[index];
                        item.user = false;
                    }
                    this.commonList = list;
                },
                showPoper: function (status) {
                    this.maskStatus = status;
                },
                saveFocus: function (_cancleFlag, _focustype) {
                    var that = this;
                    setTimeout(function () {
                        $.post('/liveajax/savefocus', { cancleFlag: _cancleFlag, liveid: that.zbId, "types": "focus", focustype: _focustype }, function () { });
                    }, 3500);
                },
                InitPageData: function () {
                    var that = this;
                    var requestObj = LiveUtil.GetRequest();
                    requestObj.tpId = that.tpId;
                    $.post("/liveajax/GetPicLiveViewModel", requestObj, function (result) {
                        if (result.dataObj) {
                            that.pageData = result.dataObj;
                            that.pageData.topic.starttime = that.resetDate(that.pageData.topic.starttime)
                            that.shareTitle = that.joinpicTitle = result.dataObj.topic.title;

                            that.$nextTick(function () {
                                if (that.pageData.topic.AdPvType == 2)
                                    new video2019('#video-container',true)//初始化播放器
                                if(that.pageData.topic.AdPvType==1 && that.pageData.topic.Posters.split(',').length>1)
                                    that.initHeadSwiper()//初始化轮播图
                            })
                            //判断是否直播中，排序切换
                            if (that.pageData.topic.status == 1) {
                                that.query.order = 'desc';
                                that.sortStatus = false;
                            }
                            // 判断图片直播模板选择
                            if (!result.dataObj.topic.skin) {
                                that.mbType = 1;
                            } else if (result.dataObj.topic.skin == 'business') {
                                that.mbType = 2;
                            } else {
                                that.mbType = 3;
                            }

                            that.initLoad();
                            that.AutoShowQRCode(that.tpId);
                        }
                        that.isPageLoading = false;
                    });
                },
                AutoShowQRCode: function (tpId) {
                    var that = this;
                    if (that.QrPopType > 0) {
                        //是否弹出关注二维码
                        if (that.QrPopType == 1) { //每天一次
                            if (!$.cookie("focusQRshow_" + tpId)) {
                                setTimeout(function () {
                                    $.ajax({
                                        type: "POST",
                                        url: "/liveajax/isPopupQrCode",
                                        data: { tpid: tpId },
                                        success: function (data) {
                                            if (data.isok && data.dataObj) {
                                                that.ShowQRCode();
                                                $.cookie("focusQRshow_" + that.tpId, "1", { expires: 1, path: '/', domain: location.hostname, secure: false });
                                            }
                                        },
                                        error: function () { }
                                    });
                                }, 1500);
                            }
                        } else { //每次进入都弹
                            setTimeout(function () {
                                $.post('/liveajax/isPopupQrCode', { tpid: tpId }, function (data) {
                                    if (data.isok && data.dataObj) {
                                        that.ShowQRCode();
                                    }
                                });
                            }, 1500);
                        }
                    }
                },
                ShowQRCode: function () {
                    var that = this;
                    var QRName = that.pageData.live.MyQRName || "微赞直播";
                    var QRCode = that.pageData.live.MyQRCode || "https://j.vzan.cc/resources/images/VzanQRCode.png";
                    popup.confirm("长按关注【" + QRName + "】", '<img src="' + QRCode + '" style="width:100%;height:100%;max-width:200px;max-height:200px;">', [], function (e) {
                        this.hide();
                    });
                    that.saveFocus(1, 'click');
                },
                ShowImgQrcode: function () {
                    var that = this;
                    var QRName = that.ImgQrcodeInfo.LookOpenImgQrcodeName || that.pageData.live.MyQRName || "微赞直播";
                    var QRCode = that.ImgQrcodeInfo.LookOpenImgQrcode || that.pageData.live.MyQRCode || "https://j.vzan.cc/resources/images/VzanQRCode.png";
                    popup.confirm("长按关注【" + QRName + "】", '<img src="' + QRCode + '" style="width:100%;height:100%;max-width:200px;max-height:200px;">', [], function (e) {
                        this.hide();
                    })
                },
                Praise: function () {
                    var that = this;
                    $.post("/liveajax/userpraise", { tpid: that.tpId, v: new Date().getTime() }, function (result) {
                        if (result.isok) {
                            that.pageData.topic.Praise = result.Msg;
                        }
                    });
                },
                PushTopic: function () {    //推送话题
                    var that = this;
                    if(that.topIsUnable){
                        that.VersionRoleTipShow();
                        return false;
                    }

                    $.post("/liveajax/getPushMsgTimes", { id: that.tpId }, function (data) {
                        if (data && data.isok) {
                            window.location.href = "/live/livepush?tpid=" + that.tpId;
                        } else {
                            layui.layer.msg(data.msg);
                        }
                    });
                },
                BeginPicTopic: function () {
                    var that = this;
                    popup.confirm('是否开始图片直播？', ' ', ['确 定', '取 消'], function (e) {
                        var button = $(e.target).attr('class');
                        if (button == 'ok') {
                            AjaxPost("/liveajax/BeginPicTopic", { tpId: that.tpId }, function (result) {
                                layer.msg(result.Msg);
                                if (result.isok) {
                                    that.pageData.topic.status = 1;
                                    that.InitPageData();
                                    that.maskStatus=false;
                                }
                            });
                        }
                        this.hide();
                    })
                },
                EndPicTopic: function () {
                    var that = this;
                    popup.confirm('是否结束图片直播？', ' ', ['确 定', '取 消'], function (e) {
                        var button = $(e.target).attr('class');
                        if (button == 'ok') {
                            AjaxPost("/liveajax/EndPicTopic", { tpId: that.tpId }, function (result) {
                                layer.msg(result.Msg);
                                if (result.isok) {
                                    that.pageData.topic.status = 0;
                                }
                            });
                        }
                        this.hide();
                    })
                },
                CountDown: function () {
                    var that=this;
                    function topicTimer(totalSeconds) {
                        if (totalSeconds <= 0) {
                            return;
                        }
                        var _videoDuration = setInterval(function () {
                            var day = 0, hour = 0, minute = 0, second = 0;//时间默认值
                            if (totalSeconds > 0) {
                                day = Math.floor(totalSeconds / (60 * 60 * 24));
                                hour = Math.floor(totalSeconds / (60 * 60)) - (day * 24);
                                minute = Math.floor(totalSeconds / 60) - (day * 24 * 60) - (hour * 60);
                                second = Math.floor(totalSeconds) - (day * 24 * 60 * 60) - (hour * 60 * 60) - (minute * 60);
                            }
                            if (day <= 9) day = '0' + day;
                            if (hour <= 9) hour = '0' + hour;
                            if (minute <= 9) minute = '0' + minute;
                            if (second <= 9) second = '0' + second;
                            $('#showday var').html(day);
                            $('#showhour var').html(hour);
                            $('#showminute var').html(minute);
                            $('#showsecond var').html(second);
                            totalSeconds--;
                            if (totalSeconds <= 0) {
                                that.countdownSeconds=-1;
                                return clearInterval(_videoDuration);
                            }
                        }, 1000);
                    }
                    //未开始话题倒计时
                    topicTimer(this.countdownSeconds);
                },
                // 首次进页面弹窗关闭
                hideShare: function () {
                    this.shareStatus = false;
                    this.ShowQRCode();
                },
                //滚动条回滚
                backTop: function () {
                    document.documentElement.scrollTop = 0;
                    document.body.scrollTop = 0;
                    this.navStatus = false;
                },
                //活动详情
                introDuce: function (status) {
                    this.introStatus = status;
                    $('html,body').css({'overflow':this.introStatus?'hidden':'visible'})
                },
                // 1、4、9宫格判断
                picChange: function (num) {
                    this.hourStatus = false;
                    this.showType = num;
                    this.isNoMore = false;
                    this.sortStatus = !this.sortStatus;
                    this.sortChoice()
                },
                //选择全部展示
                gainData: function (stauts) {
                    this.hourStatus = stauts;
                    this.ptCount = -1;
                    this.count = -1;
                    this.showType = 2;
                    this.isNoMore = false;
                    this.sortStatus = !this.sortStatus;
                    this.choosePic=false;
                    this.megicList=[];
                    this.sortChoice()
                },
                //分享
                sharePic: function (status) {
                    var that = this;
                    if (status) {
                        that.loading = weui.loading('正在加载');
                        $.post("/liveajax/GetTopicPicDetailBase64", { picId: that.activePic.Id }, function (result) {
                            if (result.dataObj) {
                                result.dataObj.FilePath=result.dataObj.FilePath.replace('i2.vzan','i2cut.vzan')+'?imageMogr2/auto-orient';
                                that.shareInfo = result.dataObj;
                                that.canvasPic();
                            }
                        }, "json");
                    } else {
                        that.detailStatus = false;
                    }
                },
                //点赞
                clickZan: function () {
                    var that = this;
                    $.post("/liveajax/PraisePic", { picId: that.activePic.Id }, function (result) {
                        if (result.isok) {
                            that.userData.isPraise = true;
                            that.userData.ZanCount++;
                            $.post("/liveajax/userpraise", { tpid: that.tpId, v: new Date().getTime() }, function (result) { });
                        } else {
                            layer.msg(result.Msg);
                        }
                    });
                },
                //打赏
                rewardUser: function () {
                    rewardVue.SetUser(this.userData.user);
                },
                //音乐播放
                switchMusic: function () {
                    if (this.playMusic) {
                        this.playMusic = false;
                        this.$refs.topoicBGM.play();
                    } else {
                        this.playMusic = true;
                        this.$refs.topoicBGM.pause()
                    }
                },
                backColor: function () {
                    var randomColor = [];
                    for (var i = 0; i <= 2; i++) {
                        randomColor.push(150 - Math.floor(Math.random() * 50 + 1) )
                    }
                    return 'rgb(' + randomColor[0] + ',' + randomColor[1] + ',' + randomColor[2] + ')'
                },
                //图片展示排序
                sortChoice: function (wss, i) {
                    this.backTop();
                    if (i !== undefined)
                        this.sortIndex = i;
                    this.loadStatus = false;
                    this.query.page = 1;
                    this.ptCount = -1;
                    this.count = -1;
                    this.commonList = [];
                    this.isNoMore = false;
                    this.dataList = [];
                    this.wssList = [];//清空websocket缓存数据
                    if (wss != true) {
                        this.sortStatus = !this.sortStatus;
                    }
                    this.sortStatus ? this.query.order = 'asc' : this.query.order = 'desc';
                    this.initLoad(wss);
                },
                initLoad: function (wss) {//传true表示为websocket更新数据，就不提示加载了
                    this.isLoading=true;
                    if((this.pageData.topic.status==-1&&this.pageData.user.roleId<=0) || this.isNoMore)
                    return false;
                    var that = this, dayArr = [];
                    $.post("/liveajax/GetTopicPicList", that.query, function (result) {
                        that.isLoading=false;
                        if (!result.dataObj.length) {
                            that.isNoMore = true;
                        }
                        result.dataObj.forEach(function(item){
                            if(that.megicList.length>0){
                                for(var i=0;i<that.megicList.length;i++){
                                    if(that.megicList[i]==item.Id){
                                        item.user = true;
                                        break;
                                    }
                                }
                            }
                        })
                        if (result.dataObj.length) {
                            if (that.dataList.length && that.query.page >=2) {
                                var lastObj = that.dataList[that.dataList.length - 1];
                            }
                            if (result.dataObj.length < 48) {
                                that.loadStatus = true;
                            }
                            result.dataObj.forEach(function (item, index) {
                                item.randomColor = that.backColor();

                                var persent = 1,
                                    fileSizeNum = parseInt(item.FileSize / 1024 / 1024);
                                switch (true) {
                                    case fileSizeNum > 3 && fileSizeNum < 5:
                                        persent = 0.7;
                                        break;
                                    case fileSizeNum >= 5 && fileSizeNum < 10:
                                        persent = 0.5;
                                        break;
                                    case fileSizeNum >= 10 && fileSizeNum < 15:
                                        persent = 0.4;
                                        break;
                                    case fileSizeNum >= 15 && fileSizeNum < 20:
                                        persent = 0.3;
                                        break;
                                    case fileSizeNum >= 20:
                                        persent = 0.2;
                                        break;
                                }
                                item.realFileSize = item.FileSize;
                                item.FileSize = parseInt(item.FileSize * persent);
                            })
                            that.dataList = that.dataList.concat(result.dataObj);

                            if (that.picDetail) {
                                that.mySwiper.virtual.cache = [];
                                that.mySwiper.virtual.slides = that.dataList;
                            }

                            if (that.hourStatus) {
                                result.dataObj.forEach(function (item, index, arr) {
                                    if (!index && that.query.page == 1) {
                                        dayArr.push(
                                            { dayTime: item.timestr.split(' ')[0], ptCount: ++that.ptCount },
                                            { hourTime: item.timestr.split(' ')[1], ptCount: ++that.ptCount },
                                            { FilePath: item.FilePath, indexs: ++that.count, ptCount: ++that.ptCount,
                                                width:item.width,height:item.height,
                                            Id: item.Id, user: false, State: item.State, EffectState: item.EffectState, randomColor: item.randomColor
                                        })
                                    } else {
                                        if (!index && that.query.page >= 2) {
                                            var prevDay = lastObj.timestr.split(' ')[0],
                                                prevHour = lastObj.timestr.split(' ')[1],
                                                nowDay = arr[index].timestr.split(' ')[0],
                                                nowHour = arr[index].timestr.split(' ')[1];
                                        } else {
                                            var prevDay = arr[index - 1].timestr.split(' ')[0],
                                                prevHour = arr[index - 1].timestr.split(' ')[1],
                                                nowDay = arr[index].timestr.split(' ')[0],
                                                nowHour = arr[index].timestr.split(' ')[1];
                                        }


                                        if (prevDay == nowDay) {
                                            if (prevHour == nowHour) {
                                                dayArr.push({ FilePath: item.FilePath, indexs: ++that.count, ptCount: ++that.ptCount,
                                                width:item.width,height:item.height,
                                                Id: item.Id, user: false, State: item.State, EffectState: item.EffectState, randomColor: item.randomColor })
                                            } else {
                                                dayArr.push(
                                                    { hourTime: nowHour, ptCount: ++that.ptCount },
                                                    { FilePath: item.FilePath, indexs: ++that.count, ptCount: ++that.ptCount,
                                                    width:item.width,height:item.height,
                                                    Id: item.Id, user: false, State: item.State, EffectState: item.EffectState, randomColor: item.randomColor }
                                                )
                                            }
                                        } else {
                                            dayArr.push(
                                                { dayTime: nowDay, ptCount: ++that.ptCount },
                                                { hourTime: nowHour, ptCount: ++that.ptCount },
                                                { FilePath: item.FilePath, indexs: ++that.count, ptCount: ++that.ptCount,
                                                    width:item.width,height:item.height,
                                                 Id: item.Id, user: false, State: item.State, EffectState: item.EffectState, randomColor: item.randomColor }
                                            )
                                        }
                                    }


                                })
                                that.commonList = that.commonList.concat(dayArr)
                            } else {
                                var data = JSON.parse(JSON.stringify(that.dataList))
                                that.commonList = that.resetData(data, false);
                            }
                        } else {
                            that.loadStatus = true;
                            that.liveBtn = false;
                            that.query.page--;
                        }
                    });
                },
                resetData: function (list, fg) {
                    var currentMinPicCount = 1;
                    var ary = []
                    // 图片排列方式
                    for (var i = 0; i < list.length; i++) {
                        var el = list[i];
                        // 设置压缩地址
                        if (el.FilePath.indexOf('imageMogr2/auto-orient') < 0, fg == undefined) {
                            el.FilePath = el.FilePath.replace("i2.vzan.cc", "i2cut.vzan.cc") + '?imageMogr2/auto-orient/thumbnail/1280x/quality/50'
                        }
                        // 带有描述
                        if (el.Description.length || (i + 1) === list.length) {
                            var left = currentMinPicCount % 2;
                            // 单数
                            if (left) {
                                el.isMP = '100%';
                            } else { // 双数
                                el.isMP = '50%';
                            }
                            // 归零小图计数
                            currentMinPicCount = 0;
                        } else {
                            el.isMP = '50%';
                        }
                        // 小图计数
                        currentMinPicCount += 1;
                        ary.push(el)
                    }
                    return ary
                },
                //加载更多图片
                loadMore: function () {
                    if(this.dataList.length>this.query.page*this.query.limit){
                        this.query.limit=this.dataList.length;
                    }
                    this.query.page++;
                    this.initLoad()
                },
                //图片细节展示
                showPicDetail: function (count, index, picId, ptCount) {
                    if(this.commonList.length==0)
                    return layer.msg('当前分类暂无图片，你可以选择其他分类进行播放')
                    if (this.choosePic) {
                        var item = '',
                            limitNum = 10;
                        this.hourStatus ? item = this.commonList[ptCount]: item = this.commonList[index];
                        if (this.megicList.length < limitNum || item.user) {
                            item.user = !item.user;

                            var path = item.FilePath;
                            if (item.FilePath.indexOf('imageMogr2') < 0) {
                                path = item.FilePath.replace('i2.vzan','i2cut.vzan') + '?imageMogr2/auto-orient/thumbnail/1280x/quality/100'
                            }
                            var scale = 1;
                            var tt = this.ptMaxWidth;
                            if (item.width > tt || item.height > tt) {
                                if (item.width > item.height) {
                                    scale = tt / item.width;
                                } else {
                                    scale = tt / item.height;
                                }
                            }
                            var dataimg = {
                                Id: item.Id,
                                FilePath: path,
                                width: item.width * scale,
                                height: item.height * scale
                            }
                            this.gifHeight = Math.max(this.gifHeight, dataimg.height);


                            // 选中切换
                            if (item.user) {
                                // 添加选中
                                this.megicList.push(dataimg)
                            } else {
                                // 移除选中
                                for (var inx = 0; inx < this.megicList.length; inx++) {
                                    var el = this.megicList[inx];
                                    if (el.Id === picId) {
                                        this.megicList.splice(inx, 1)
                                        break;
                                    }
                                }
                            }
                        } else {
                            this.layers.msg('不能超过' + limitNum + '张哦！')
                        }
                    } else {
                        if (!index) {
                            this.gainPicUser(picId)
                        }
                        var _this = this,
                            swiperIndex = index;
                        _this.picDetail = true;
                        _this.swiperIndex = ++swiperIndex;
                        _this.activeIndex = index;
                        var count = count ? count : 999999999;
                        _this.picWord=_this.activePic.displyOriginal?'当前为原图':'查看原图';
                        //if (count ==5000 && this.IsAutoPlayMusic && _this.$refs.topoicBGM) {
                        if (count != 999999999 && this.IsAutoPlayMusic && _this.$refs.topoicBGM) {
                            _this.musicStatus = true;
                            _this.playMusic = false;
                            _this.$refs.topoicBGM.play()
                            setTimeout(function(){
                                _this.$refs.topoicBGM.play()
                            },2000)
                        }
                        _this.initSwiper(count, index, _this.dataList);
                    }
                },
                renderCover: function () {
                    if (!this.coverFinish) {
                        this.jjgsawClick();
                        this.coverFinish = true;
                    }
                },
                // 开始拼图  拼图使用了这个页面的全局函数 loadImg centerImg drawText
                // 初始化并加载所有图片 操作顺序：joinpicInit=>joinpic1/joinpic2/joinpicGIF=>joinEnd
                // imglist 选中的图片
                joinpicInit: function(imglist){
                    var that = this;
                    if (that.ptType <= 2) {
                        var len = imglist.length
                        var iimg = 0
                        for (var index = 0; index < imglist.length; index++) {
                            var v = imglist[index]
                            var el = loadImg(v.FilePath);
                            this.joinImgList.push(el)
                            el.onload = function () {
                                iimg += 1;
                                if(iimg == len) {
                                    if(that.ptType === 1){
                                        that.joinpic1();// 长图
                                    } else if(that.ptType === 2){
                                        that.joinpic2();// 宫格
                                    }
                                }
                            }
                        }
                    }
                },
                joinpicGIF: function () {
                    this.joinpicMode = 3;
                    var that = this;
                    this.coverheight = 420;
                     // 创建一张GIF
                     var gif = new GIF({
                        workers: 2,
                        quality: this.megicList.length,
                        workerScript: '/livecontent/plugin/gif/gif.worker.js'
                    });
                    // 图片索引
                    var times = 0
                    // 要生成的图片数量
                    var len = this.megicList.length - 1;
                    // 通过 canvas 重新画图片，裁剪图片
                    function renderImg () {
                        var item = that.megicList[times];
                        // 没有可画图片，开始渲染GIF
                        if (!item) {
                            gif.render();
                            return
                        }
                        // 将图片渲染到canvas上
                        var canvas = document.createElement('canvas');
                        if (canvas) {
                            var ctx = canvas.getContext('2d');
                            canvas.width =that.ptMaxWidth;
                            canvas.height = that.gifHeight;
                        }
                        that.coverheight = that.gifHeight;
                        var path = item.FilePath;
                        if (path.indexOf('thumbnail/1280x') >= 0) {
                            path = path.replace('/1280x','/840x')
                        }
                        console.log(path)
                        var img = loadImg(path, function () {
                            // 当图片高度不够 gifHeight 时，图片居中
                            var maxw =that.ptMaxWidth;
                            var h = item.height > that.gifHeight ? that.gifHeight : item.height;
                            var y = (that.gifHeight - item.height) / 2;

                            var w = item.width > maxw ? maxw : item.width;
                            var x = (maxw - item.width) / 2;
                            x = x < 0 ? 0 : x
                            ctx.drawImage(img, x, y, w, h);
                            if (times <= len) {
                                times += 1;
                                // 添加图片，间隔一秒
                                gif.addFrame(canvas, {delay: 1000});
                                return renderImg()
                            }
                        })
                    }
                    renderImg();
                    gif.on('finished', function(blob) {
                        var myGIF = new File([blob], 'image.gif');
                        var formData = new FormData()
                        formData.append('image', myGIF)
                        formData.append('isgif', 1)
                        $.ajax({
                            url: '/liveajax/UploadImages',
                            data: formData,
                            type: "POST",
                            async: false,
                            cache: false,
                            contentType: false,
                            processData: false,
                            success: function(data) {
                                if (data.isok) {
                                    var src = data.bigimg;
                                    $('.jjgsawImg').attr('src', src);
                                    that.jjgsaw = true;
                                    that.loading.hide();
                                    that.joinImgList = [];
                                }
                            },
                            error: function(r) {
                                layer.msg('生成图片失败！')
                            }
                        })

                    });
                },
                joinpic1: function(){//拼图：长图
                    var that = this;
                    this.joinpicMode = 1;
                    var _this = this;
                    var canvas = document.createElement('canvas'),
                    ctx = canvas.getContext('2d');
                    // 设计稿宽度
                    canvas.width = 1200;
                    var h1 = 0, h3 = (320*that.bit), h2 = 0, drawImgH = [];
                    this.joinImgList.forEach(function(v){
                        var thisH = canvas.width * v.height / v.width;
                        // 计算得出每个图片的高度放入数组
                        drawImgH.push(thisH);
                        h2 += thisH;
                    })
                    canvas.height = h1 + h2 + h3;
                    this.coverheight = canvas.height;
                    ctx.fillStyle = this.ptStlye === 'happy' ? '#FF1732' : this.ptStlye === 'business' ? '#262626' : '#fff';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    var ptPadding = _this.ptPadding * 2;
                    this.joinImgList.forEach(function (item, index) {
                        ctx.drawImage(item, (ptPadding*_this.bit), h1 + (ptPadding*_this.bit), canvas.width - ((ptPadding*_this.bit) * 2), drawImgH[index] - (ptPadding*_this.bit))
                        h1 += drawImgH[index];
                    })
                    if (this.ptStlye !== 'fresh') {
                        this.joinEnd(canvas, ctx, (296*that.bit), h2, h3);
                    } else {
                        var infoBg = loadImg('../../livecontent/topic/images/fresh-bg.png', function () {
                            ctx.drawImage(infoBg, 0, h2, (690*that.bit), (320*that.bit));
                            that.joinEnd(canvas, ctx, (296*that.bit), h2, h3);
                        })
                    }
                },
                joinpic2: function(){//拼图：宫格
                    var that = this;
                    this.joinpicMode = 2;
                    var canvas = document.createElement('canvas'),
                    ctx = canvas.getContext('2d');
                    //设计稿宽度
                    canvas.width = 1200;
                    var h1 = 0, h3 = (320*that.bit),h2 = this.joinImgList.length * (347*that.bit) / 2;
                    canvas.height = h1 + h2 + h3;
                    this.coverheight = canvas.height;
                    ctx.fillStyle = this.ptStlye === 'happy' ? '#FF1732' : this.ptStlye === 'business' ? '#262626' : '#fff';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    this.joinImgList.forEach(function (item, index) {
                        var is = (index + 1) % 2 == 0;
                        //ctx.drawImage(item,is?347:0,h1,343,343);
                        centerImg(item, ctx, is ? (347*that.bit) : 0, h1, (343*that.bit), (343*that.bit));
                        is ? h1 += (347*that.bit) : null;
                    })
                    if (this.ptStlye !== 'fresh') {
                        this.joinEnd(canvas, ctx, (296*that.bit), h2, h3);
                    } else {
                        var infoBg = loadImg('../../livecontent/topic/images/fresh-bg.png', function () {
                            ctx.drawImage(infoBg, 0, h2, (690*that.bit), (320*that.bit));
                            that.joinEnd(canvas, ctx, (296*that.bit), h2, h3);
                        })
                    }
                },
                // 拼图收尾工作 这里最难搞的图片已经画完了，补上剩下的字和图标、二维码即可
                joinEnd: function(canvas, ctx, h1, h2, h3){
                    var that = this;
                    // 根据设计稿不同风格定颜色，详情请看设计稿
                    ctx.font = 'normal bold '+(30*that.bit)+'px Microsoft YaHei';
                    ctx.fillStyle = this.ptStlye == 'business' ? '#FFA800' : this.ptStlye === 'happy' ? '#DBB76C' : this.ptStlye === 'fresh' ? '#6BB519' : this.ptStlye === 'pink' ? '#FE4161' : '#353535';
                    // 信息背景快
                    if (this.ptStlye !== 'business' && this.ptStlye !== 'happy') {
                        var fillRoundRectBgColor = this.ptStlye === 'pink' ? '#FFECEF' : this.ptStlye === 'fresh' ? 'rgba(107, 181, 25, 0.3)' : 'rgba(245, 246, 247, 1)'
                        fillRoundRect(ctx, (31*that.bit), (h2 + (50*that.bit)), (622*that.bit), (234*that.bit), (8*that.bit), fillRoundRectBgColor);
                        this.fillCoverInfo(canvas, ctx, h1, h2, h3)
                    } else {
                        if (this.ptStlye === 'business') {
                            var infoBg = loadImg('../../livecontent/topic/images/business-bg.png', function () {
                                ctx.drawImage(infoBg, (31*that.bit), (h2 + (50*that.bit)), (622*that.bit), (234*that.bit));
                                that.fillCoverInfo(canvas, ctx, h1, h2, h3)
                            })
                        }
                        else if (this.ptStlye === 'happy') {
                            var infoBg = loadImg('../../livecontent/topic/images/happy-bg.png', function () {
                                ctx.drawImage(infoBg, (31*that.bit), (h2 + (50*that.bit)), (622*that.bit), (234*that.bit));
                                that.fillCoverInfo(canvas, ctx, h1, h2, h3)
                            })
                        }
                    }
                },
                fillCoverInfo: function (canvas, ctx, h1, h2, h3) {
                    var that = this;
                    // 图片下方，方块的内容开始高度
                    var rectY = h2 + (110*that.bit);
                    // 写标题 这里如果只写了一行，下面的文字都要往上偏移
                    drawText(ctx, this.joinpicTitle, (52*that.bit), rectY, (380*that.bit), (46*that.bit), 2);
                    // 累加高度， 标题限制两行
                    var y = (2 * (46*that.bit)) + rectY;
                    ctx.font = 'normal normal '+(30*that.bit)+'px Microsoft YaHei';
                    ctx.fillStyle= (this.ptStlye == 'business' || this.ptStlye === 'happy') ? '#ffffff':'#747474';
                    // 二维码
                    var qrcode = loadImg($("#QRCode").find("canvas").get(0).toDataURL('image/jpeg'), dirimg);

                    var dateIconUrl = '../../livecontent/topic/images/share-icon-date'+ ((this.ptStlye == 'business' || this.ptStlye === 'happy') ? '-w':'') +'.png'
                    var addressIconUrl = '../../livecontent/topic/images/share-icon-address'+ ((this.ptStlye == 'business' || this.ptStlye === 'happy') ? '-w':'') +'.png'
                    // 时间, 图标
                    var icon1 = loadImg(dateIconUrl, dirimg);
                    // 地点, 图标
                    var icon2 = loadImg(addressIconUrl, dirimg);
                    // var icons = [qrcode, icon1, icon2]
                    var dirimg_i = 0
                    function dirimg () {
                        dirimg_i += 1;
                        if (3 === dirimg_i) {
                            if (!that.showLocalTime) {
                                // 时间, 图标
                                drawText(ctx, that.pageData.topic.starttime, (92*that.bit), y + (10*that.bit), (500*that.bit), (28*that.bit), 1);
                                ctx.drawImage(icon1, (52*that.bit), y - (16*that.bit), (32*that.bit), (32*that.bit));
                                if (that.pageData.topic.PicAddress) {
                                    // 地址, 图标
                                    drawText(ctx, that.pageData.topic.PicAddress, (92*that.bit), y + (50*that.bit), (320*that.bit), (36*that.bit), 1);
                                    ctx.drawImage(icon2, (52*that.bit), y + (22*that.bit), (32*that.bit), (32*that.bit));
                                }
                            } else {
                                drawText(ctx, '长按图片扫码观看直播', (52*that.bit), y + (30*that.bit), (500*that.bit), (28*that.bit), 1);
                            }
                            // 二维码底色
                            fillRoundRect(ctx, (450*that.bit), canvas.height - (240*that.bit), (180*that.bit), (180*that.bit), (4*that.bit), '#ffffff');
                            // 二维码
                            ctx.drawImage(qrcode, (460*that.bit), canvas.height - (230*that.bit), (160*that.bit), (160*that.bit));
                            canvas.toBlob(function (blob) {
                                window.coverImageUrl = window.URL.createObjectURL(blob)
                                $('.jjgsawImg').attr('src', canvas.toDataURL("image/jpeg"));
                                that.jjgsaw = true;
                                that.joinImgList = [];
                                that.loading.hide();
                                canvas.remove();
                            })
                        }
                    }
                },
                //旧版拼图功能
                jjgsawClick: function () {
                    // 宫格
                    if (this.ptType === 2 ) {
                        if (this.megicCount % 2 === 1) {
                            layer.msg('图片数量不能为奇数')
                            return
                        }
                    }

                    if (this.ptType === 3) {
                        if (this.megicCount < 2) {
                            layer.msg('请至少选择2张图片！')
                            return
                        }
                    }

                    if (this.megicCount > 10) {
                        layer.msg('图片数量不能大于10张')
                        return
                    }

                    if (this.megicCount) {
                        this.loading = weui.loading('正在拼图中');
                        this.joinpicInit(this.megicList)
                    }
                },
                //关闭拼图
                closeJjgsaw: function () {
                    this.jjgsaw = false;
                    this.$refs.jjgsaw.scrollTop = 0;
                    this.choiceType(0, false);
                    this.coverFinish = false;
                    this.choosePic = false;
                    this.joinpicTitle = "趣嗒嗒北京分公司开业直播";
                    this.ptPadding = false;
                },
                //摧毁swiper实例
                hidePicDetail: function () {
                    if (this.$refs.topoicBGM) {
                        this.$refs.topoicBGM.pause()
                        this.musicStatus = false;
                    }
                    this.picDetail = false;
                    this.mySwiper.virtual.slides = [];
                    this.mySwiper.virtual.update();
                    this.mySwiper.destroy();
                    this.picWord = '查看原图';
                },
                //获取摄影师的数据
                gainPicUser: function (id) {
                    var that = this;
                    id = id || that.dataList[0].Id;
                    $.post("/liveajax/GetImgTopicPicDetail", { Id: id,tpid:that.tpId }, function (res) {
                        that.userData = res.dataObj;
                        that.userData.imgVisitation++;
                    })
                },
                //初始化swiper
                initSwiper: function (count, index, dataList) {
                    var _this = this;
                    _this.$nextTick(function () {
                        _this.mySwiper = new Swiper('.swiper-container', {
                            initialSlide: index,
                            centeredSlides: true,
                            spaceBetween: 20,
                            lazy: true,
                            autoplay: {
                                delay: count,
                                disableOnInteraction: false,
                            },
                            zoom: {
                                maxRatio: 2.5,
                                toggle: true,
                            },
                            virtual: {
                                slides: dataList,
                                cache: true,
                                renderSlide: function (slide, index) {
                                    var fliePath = '',
                                        fileSize = parseInt(slide.realFileSize / 1024 / 1024),
                                        quality = 0;

                                    switch (true) {
                                        case fileSize >= 0 && fileSize <= 3:
                                            quality = 100;
                                            break;
                                        case fileSize > 3 && fileSize <= 5:
                                            quality = 85;
                                            break;
                                        case fileSize > 5 && fileSize <= 10:
                                            quality = 80;
                                            break;
                                        case fileSize > 10 && fileSize <= 15:
                                            quality = 60;
                                            break;
                                        case fileSize > 15 && fileSize <= 20:
                                            quality = 50;
                                            break;
                                        case fileSize > 20:
                                            quality = 40;
                                            break;
                                    }
                                    //fliePath = slide.displyOriginal ? slide.FilePath :  LiveUtil.resizeImg(slide.FilePath, 640, 0, slide.isOpenWaterMark, slide.waterMarkUrl, slide.waterMarkX, slide.waterMarkY,80);
                                    fliePath = slide.displyOriginal ? slide.FilePath : slide.FilePath.replace('i2.vzan','i2cut.vzan')+'?imageMogr2/auto-orient/thumbnail/1280x/quality/'+quality;
                                    return '<div class="swiper-slide"><div class="swiper-zoom-container"><img class="swiper-lazy" data-src="' + fliePath + '"><div class="swiper-lazy-preloader"></div></div></div>'
                                }
                            },
                            on: {
                                slideChangeTransitionStart: function () {
                                    if (this.zoom.scale > 1) {
                                        this.zoom.out();
                                    }
                                },
                                slideChange: function () {
                                    var activeIndex = this.activeIndex,
                                        swiperThis = this;
                                    _this.swiperIndex = ++activeIndex;
                                    _this.activeIndex = this.activeIndex;
                                    _this.activePic.displyOriginal ? _this.picWord = '当前为原图' : _this.picWord = '查看原图';
                                    _this.gainPicUser(_this.activePic.Id);
                                    activeIndex+2 >= _this.query.page * 48? _this.loadMore() : '';
                                    if (!this.activeIndex) {
                                        _this.layers.msg("已经滑动到第一张");
                                    } else if (this.activeIndex == _this.imgCount - 1) {
                                        _this.layers.msg("已经滑动到最后一张");
                                    }
                                },
                            },
                        })
                    })
                },
                //查看原图
                lookOriginal: function () {
                    var _this = this,
                        picture = $('.swiper-slide-active .swiper-zoom-container img'),
                        fileSize = parseInt(this.dataList[this.activeIndex].realFileSize / 1024 / 1024),
                        filePath = '',
                        quality = 0;

                    switch (true) {
                        case fileSize >= 0 && fileSize <= 3:
                            quality = 100;
                            break;
                        case fileSize > 3 && fileSize <= 5:
                            quality = 85;
                            break;
                        case fileSize > 5 && fileSize <= 10:
                            quality = 80;
                            break;
                        case fileSize > 10 && fileSize <= 15:
                            quality = 60;
                            break;
                        case fileSize > 15 && fileSize <= 20:
                            quality = 50;
                            break;
                        case fileSize > 20:
                            quality = 40;
                            break;
                    }
                    //filePath = true ? _this.activePic.FilePath :LiveUtil.resizeImg(_this.activePic.FilePath, 0, 0, _this.activePic.isOpenWaterMark, _this.activePic.waterMarkUrl, _this.activePic.waterMarkX, _this.activePic.waterMarkY, quality);

                    if (!_this.activePic.displyOriginal) {
                        var loading = weui.loading('正在加载')
                        // filePath = _this.activePic.FilePath.replace('i2.vzan.cc', 'i2cut.vzan.cc') + '?imageMogr2/auto-orient/thumbnail/1280x/quality/'+100;
                        var ruls = '?imageMogr2/auto-orient'
                        if (_this.activePic.width < 1280) {
                            ruls += '/thumbnail/1280x'
                        }
                        filePath = _this.activePic.FilePath.replace('i2.vzan.cc', 'i2cut.vzan.cc') + ruls + '/quality/' + quality;
                        // 更新DOM 图片
                        var img = new Image()
                        img.src = filePath;
                        picture.attr('src', filePath);
                        // 更新图片地址
                        _this.dataList[_this.activeIndex].FilePath = filePath;
                        img.onload=function () {
                            _this.picWord = '当前为原图';
                            if(_this.mySwiper.zoom.scale==1){
                               $('.swiper-container .swiper-slide-active .swiper-zoom-container').css('transform','translate3d(0px, 0px, 0px)')
                            }
                            loading.hide();
                            _this.activePic.displyOriginal = true;
                            _this.mySwiper.update()
                        }
                        //弹出关注公众号二维码
                        if (this.ImgQrcodeInfo.IsLookOpenImgQrcode && $.cookie('islookopenimgqrcode_' + this.tpId) != "1") {
                            this.ShowImgQrcode();
                            $.cookie('islookopenimgqrcode_' + this.tpId, "1", { expires: 1, path: '/' });
                        }
                    }

                },
                resetDate:function(time){//后端传过来的时间转换 如/Date(1555638968000)/=>2017-12-12 12:12:12
                    var dt = new Date(time.replace("/Date(", "").replace(")/", "")*1);
                    function fit(n){
                        return n<10?'0'+n:''+n;
                    }
                    return dt.getFullYear() + "-" + fit(dt.getMonth() + 1) + "-" + fit(dt.getDate()) +'  '+fit(dt.getHours())+':'+ fit(dt.getMinutes())+':'+ fit(dt.getSeconds())
                },
                //canvas绘图
                canvasPic:function(){
                    var that = this,
                    canvas = document.createElement('canvas'),
                    ctx = canvas.getContext('2d'),
                    shareImg = loadImg(that.shareInfo.FilePath);
                    shareImg.onload = function(){
                        var backImg = loadImg(that.shareStyleData[that.shareStyleId].bg);
                        backImg.onload = function(){
                            var bit = 1.7;// 源尺寸 690, 设计稿宽度
                            canvas.width = 1200;
                            var h1=shareImg.height*canvas.width/shareImg.width,//分享图片高度
                                h2=backImg.height*canvas.width/backImg.width;//文字和二维码内容高度
                            canvas.height = h1+h2;
                            drawRoundRect(ctx,0,0,canvas.width,canvas.height,(20 * bit));//画圆角矩形
                            ctx.clip();//剪切矩形后 开始画画
                            ctx.drawImage(shareImg, 0, 0, canvas.width, h1);
                            ctx.drawImage(backImg, 0, h1, canvas.width, h2);
                            ctx.font = 'normal normal bold 72px Arial';
                            ctx.fillStyle = that.shareStyleData[that.shareStyleId].title;
                            drawText(ctx,that.shareTitle,(30 * bit),h1+(77 * bit),(627 * bit),(52 * bit), 2);//标题
                            ctx.fillStyle = that.shareStyleData[that.shareStyleId].text;
                            ctx.font = 'normal normal 46px Arial';
                            if(that.pageData.topic.PicAddress){
                                if (drawText(ctx,'地点：'+ that.pageData.topic.PicAddress,(37*bit),h1+(254*bit),(447*bit),(42*bit),2)==1){//地点 一行字和两行字的情况
                                    drawText(ctx,'时间：'+ that.pageData.topic.starttime,(37*bit),h1+(296*bit),(447*bit),(32*bit),1);//时间
                                }else{
                                    drawText(ctx,'时间：'+ that.pageData.topic.starttime,(37*bit),h1+(338*bit),(447*bit),(32*bit),1);//时间
                                }
                            }else{
                                drawText(ctx,'时间：'+ that.pageData.topic.starttime,(37*bit),h1+(254*bit),(447*bit),(32*bit),1);//时间
                            }
                            var qrcode = loadImg($("#QRCode").find("canvas")[0].toDataURL('image/jpeg'));//二维码
                            qrcode.onload = function(){
                                ctx.fillStyle='#fff';
                                ctx.fillRect((526 * bit),h1+(222 * bit),(124 * bit),(122 * bit));//给二维码四周填充白色 不然会很难看
                                ctx.drawImage(qrcode, (526 * bit)+3, h1+(222 * bit)+3, (124 * bit)-6, (122 * bit)-6);//放置在矩形里面 长宽各小6像素
                                that.shareImgUrl=canvas.toDataURL('image/png');
                                that.loading.hide();
                                that.detailStatus = true;
                                $('.sharePic-container').css('line-height',$(window).height()-136+'px');//设置行高垂直居中
                            }
                        }

                    }
                },
                IsComplaint: function () {
                    var that = this;
                    //是否可以继续提交反馈信息（每个用户一天只能提交3次）
                    $.post('/live/IsComplaint', {
                        userId: '0',
                        Id: '1935643604',
                        ctype: 0,
                    }, function (data) {
                        if (data.isok) {
                            layer.msg("我们已收到您的举报，请耐心等待处理结果");
                        }
                        else {
                            location.href = "/live/WXComplaint?ctype=0&id=1935643604&v=" + new Date().getTime() + "&fr=" + '';
                        }
                    });
                },
                ToEditTop:function(){
                    var that = this;
                    if(that.topIsUnable)
                    {
                        that.VersionRoleTipShow();
                        return false;
                    }
                    window.location.href = '/live/topicset-' + that.zbId + '-' + that.tpId + '?v=' + new Date().getTime()
                },
                ToInviteGuest:function(){
                    var that = this;
                    if(that.topIsUnable)
                    {
                        that.VersionRoleTipShow();
                        return false;
                    }
                    window.location.href = "/live/Invite-733664?tpid=1935643604&types=invite";
                },
                InviteTopAdmin: function () {//邀请话题管理员
                    var that = this;
                    if (that.topIsUnable) {
                        that.VersionRoleTipShow();
                        return false;
                    }
                    location.href = "/live/Invite-" + that.zbId + "?tpid=" + that.tpId + "&types=invitetp";
                },
                ToImgManage:function(){
                    var that = this;
                    if(that.topIsUnable)
                    {
                        that.VersionRoleTipShow();
                        return false;
                    }
                    window.location.href = "/live/topicpicmanage?tpid=1935643604&v=637047595925147615";
                },
                waterFit:function (list,dir){
                    var left=[],right=[],h1=0,h2=0;
                    for(var i=0;i<list.length;i++){
                        list[i].index=i;
                        if(h1<=h2){
                            left.push(list[i])
                            h1+=(list[i].height/list[i].width)
                        }else{
                            right.push(list[i])
                            h2+=(list[i].height/list[i].width)
                        }
                    }
                    return dir=='left'?left:right
                },
                VersionRoleTipShow:function(){
                    var that = this;
                    var tip = "";
                    if(that.isSiteCreator){
                        tip = "当前直播间版本，图片直播场次已超出上限，将对超出场次上限的图片直播进行失效处理，失效期间无法对该话题进行管理。如需继续管理该话题，可进行直播间升级";
                    }
                    else{
                        tip = "当前直播间版本，图片直播场次已超出上限，将对超出场次上限的图片直播进行失效处理，失效期间无法对该话题进行管理。如需继续管理该话题，请联系直播间创建者进行处理";
                    }

                    layer.open({
                        content: tip
                          ,btn: ['立即升级', '我知道了']
                          ,yes: function(index, layero){
                              window.location = "/live/AccountManage-3100?zbid=733664&v=" + Math.random();
                          }
                          ,btn2: function(index, layero){
                              layer.closeAll();
                              return false;
                          }
                          ,cancel: function(){
                          }
                    });
                },
                initHeadSwiper:function(){//顶部轮播图car
                    new Swiper('.pic-head-slide',{
                        loop:true,
                        pagination: {
                            el: '.swiper-pagination',
                            renderBullet:function(index,className){
                                return '<span class="pic-head-index '+className+'"></span>';
                            },
                        },
                        autoplay : {
                                delay:5000
                        }
                    })
                },
                wssInit:function(){//websocket初始化
                    var inputTimer = 0;
                    var that = this;
                    var strkey = "wss://ws.vzan.com:2298/vzfrom=&uname=" + (that.pageData.user != null ? that.pageData.user.nickname : "") +
                        "&zbid=" + that.zbId + "&tid=" + (that.pageData.topic.RelayId > 0 ? that.pageData.topic.RelayId : that.tpId) +
                        "&uid=" + (that.pageData.user != null ? that.pageData.user.uid : 0) + "&rid=" + (that.pageData.user != null ? that.pageData.user.roleId : 0) +
                        "&rtid=" + (that.pageData.topic.RelayId > 0 ? that.tpId : that.pageData.topic.RelayId) + "&shareuid=" + that.shareuid + "&tpstate=" + that.pageData.topic.status;
                    window.wss = new WebSocket(strkey);
                    wss.onmessage=function(evt){
                        var msg = evt.data;
                        if (typeof evt.data != "object") {
                            msg = eval('(' + evt.data + ')');
                        }
                        if(msg.Types!=undefined)
                            return 0;
                        if(msg[0].Msg.content.indexOf('本次直播开始于')>=0)
                            window.location.reload()
                        if ((that.pageData.topic.status == -1 && that.pageData.user.roleId<=0))
                            return 0;
                        if(msg[0].Types=='正常消息' && JSON.parse(msg[0].Msg.content).imgList != undefined) {
                            var data=JSON.parse(msg[0].Msg.content);
                            if(msg.length>1){
                                data=JSON.parse(msg[msg.length-1].Msg.content);
                                for(var i=0;i<msg.length-1;i++){
                                    var c=JSON.parse(msg[i].Msg.content).imgList
                                    data.imgList=c.concat(data.imgList)
                                }
                            }
                            function update(){//更新总图片数和各个分类图片数
                                that.pageData.imgclassify=data.imgclassify;
                                that.pageData.topic.picCount=data.picCount;
                            }
                            that.wssCount=data.picCount;
                            that.wssImgclassify=data.imgclassify;

                            if(data.classifyId!=that.query.typeid&&that.query.typeid!=0)//更新的不是当前分类时，只更新数量（全部时例外）
                                return update();
                            if(that.navStatus){//不在第一屏
                                that.wssTip=true;
                                that.wssList=that.wssList.concat(data.imgList);//不在第一屏时，更新数据存起来，让用户手动更新

                                that.wssImgclassify=data.imgclassify;
                            }else if(that.hourStatus){
                                update()
                                that.sortChoice(true)
                            }else{
                                update()
                                that.wssLoad(data.imgList)
                            }
                        } else if (msg[0].Types=='正常消息' && msg[0].Msg.msgtype===70) {
                            var data = JSON.parse(msg[0].Msg.content);
                            // 更新分类简介
                            if (data.IsClass) {
                                var index =  $('#class-id-' + data.Id).data('index');
                                that.pageData.imgclassify[index] && (that.pageData.imgclassify[index].Description = data.Description);
                            } else {
                                // 更新图片简介
                                var index = $('#pic-id-' + data.Id).data('index');
                                if (that.commonList[index]) {
                                    that.commonList[index].Description = data.Description;
                                    data.DescriptionTimeStr && (that.commonList[index].DescriptionTimeStr = data.DescriptionTimeStr);
                                    that.commonList = that.resetData(that.commonList);
                                }
                            }
                        }
                    }
                    wss.onclose=function(){
                        wss=null;
                        that.wssInit();
                    }
                },
                wssLoad:function(list){
                    var that=this;
                    this.wssTip=false;
                    if(!this.hourStatus){
                        this.sortStatus? $(window).scrollTop($('.picPhoto-con').height()):$(window).scrollTop(211);
                        this.pageData.topic.picCount=this.wssCount;
                        this.pageData.imgclassify=this.wssImgclassify;
                        list.forEach(function(item,index){
                            var persent=1,
                            fileSizeNum=parseInt(item.FileSize / 1024 / 1024);
                            switch (true) {
                                case fileSizeNum >= 3 && fileSizeNum < 5:
                                    persent = 0.7;
                                    break;
                                case fileSizeNum >= 5 && fileSizeNum < 10:
                                    persent = 0.5;
                                    break;
                                case fileSizeNum >= 10 && fileSizeNum < 15:
                                    persent = 0.4;
                                    break;
                                case fileSizeNum >= 15 && fileSizeNum < 20:
                                    persent = 0.3;
                                    break;
                                case fileSizeNum >= 20:
                                    persent = 0.2;
                                    break;
                            }
                            item.isMP = '50%';
                            item.Description = '';
                            item.FileSize = parseInt(item.FileSize * persent);
                            if (that.sortStatus) {
                                that.commonList.push(item);
                                that.dataList.push(item);
                            } else {
                                that.commonList.unshift(item);
                                that.dataList.unshift(item);
                            }
                        })
                        // this.commonList=that.sortStatus?this.commonList.concat(list):list.concat(this.commonList)
                        this.wssList=[]
                        if (this.isPicStory) {
                            that.commonList = that.resetData(that.commonList);
                            that.dataList = that.resetData(that.dataList, false);
                        }
                    }else{
                        this.pageData.topic.picCount=this.wssCount;
                        this.pageData.imgclassify = this.wssImgclassify;
                        this.sortChoice(true)
                    }

                },
                faceResult: function () {
                    // 缓存人脸小图
                    var flists = JSON.stringify(this.userData.FaceImages);
                    sessionStorage.setItem('Own_face_photo', flists);
                    // 获取当前图片地址
                    var img = event.target;
                    if (event.target.src) {
                        img = event.target.src;
                    } else {
                        img = event.target.querySelector('img').src;
                    }
                    img = img.replace('http','');
                    window.location.href = '/live/FaceFindResult?tpId=' + this.tpId + '&zbId=' + this.zbId  +'&tpImgId='+ this.activePic.Id + '&img=' + img;
                },
                findMe:function(){
                    if(this.pageData.topic.status==-1||this.pageData.topic.picCount==0)
                    return layer.msg('暂无图片，无法使用人脸识别')
                    window.location.href = '/live/FaceFindYourself?tpId=' + this.tpId + '&zbId=' + this.zbId;
                },
                // 图文故事管理
                gotoPicStoryMgr: function (isFree) {
                    var that = this;
                    // 免费版弹出框
                    if (isFree) {
                        layer.confirm('当前直播间版本不支持图文故事功能，如需使用图文故事功能请进行直播间升级?', { icon: 3, title: '升级提示', btn: ["立即升级", "取消"] }, function (index) {
                            location.href = "/live/AccountManage-3100?zbid=733664&v="+(+new Date());
                        });
                    }else if(that.topIsUnable) {
                        that.VersionRoleTipShow();
                    } else {
                        location.href = "/live/PicStoryModify?zbid=733664&tpid=1935643604&v="+(+new Date());
                    }
                }
            },
            created: function () {
                var _this = this;
                $('#QRCode').qrcode({
                    render: "canvas",
                    width: 100,
                    height: 100,
                    text: location.origin + "/live/tvchat-" + _this.tpId + "?v=" + new Date().getTime()
                });
                _this.InitPageData();
                _this.CountDown();
                _this.saveFocus(0, '');
                window.onload=function(){
                    _this.wssInit()
                }
            this.waterWidth=($('body').width()-30)/2;
            },
            mounted: function() {
                var that = this,
                    startY = 0,
                    moveY = 0;
                //初始化layui
                layui.use(['layer'], function () {
                    that.layers = layui.layer;
                })
                var top=0;//滚动的距离
                window.addEventListener('scroll', function () {
                    if (that.dropdown) {
                        that.dropdown = false;
                    }

                    var scrollTop = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop,
                    wh=$(window).height(),
                    wt=$(window).scrollTop()
                    top = $(window).scrollTop();
                    // TODO: 200 or 289目前写死，可以获取上面元素高度得到值
                    if(that.marqueeText.mt_isOpen) { // 是否开启滚动文字
                        if(that.marqueeText.mt_isLocation===1) { // 滚动文字的位置（1-滚动固定位置顶部，2-视频下方）
                            that.showFlexMarquee = scrollTop >= 200;
                            that.navStatus = scrollTop >= 260
                            if(that.showFlexMarquee) {
                                if (!that.isLoading&&$('body')[0].scrollHeight-wt-wh <=wh*5) {
                                    that.loadMore();
                                }
                                if(that.wssTip){//前提
                                    that.wssTip=false;//滚动时隐藏
                                    var clock=setInterval(function(){
                                        if(top==$(window).scrollTop()){
                                            that.wssTip=true;//停止滚动时显示 但小于280就不再显示
                                            clearInterval(clock);
                                        }
                                    },400)
                                }
                            }
                            return
                        }
                    }
                    that.navStatus = scrollTop >= 289
                    if (!that.isLoading&&$('body')[0].scrollHeight-wt-wh <=wh*5) {
                        that.loadMore();
                    }
                    if(that.wssTip){//前提
                        that.wssTip=false;//滚动时隐藏
                        var clock=setInterval(function(){
                            if(top==$(window).scrollTop()){
                                that.wssTip=true;//停止滚动时显示 但小于280就不再显示
                                clearInterval(clock);
                            }
                        },400)
                    }
                }, false)

                document.addEventListener('touchstart', function (e) {
                    startY = e.touches[0].clientY;
                })
                document.addEventListener('touchmove', function (e) {
                    moveY = e.touches[0].clientY;
                })
                document.addEventListener('touchend', function (e) {
                    startY > moveY ? that.liveBtn = true : that.liveBtn = false;
                })

                // 获取是否可以进行图文编辑
                if (that.isPicStory) {
                    $.getJSON("/liveajax/PicStoryOper", { tpid: '1935643604', action: 'canmodify' }, function (rs) {
                        if (rs.isok) {
                            that.isModifyTw = true;
                        }
                    });
                }
            }
        })

        //canvas写多行文字，满足所有需求,而且方法会返回写了多少行数
        //参数：画笔，输入文字，坐标x，坐标y，行宽度，行高度，最大行数（超出最大行数用...结尾）
        function drawText(ctx, text, x, y, maxWidth, lineHeight,maxLine) {
            var arrText = text.split('');
            var line = '';
            var num = 1;
            for (var n = 0; n < arrText.length; n++) {
                var testLine = line + arrText[n];
                var metrics = ctx.measureText(testLine);
                var testWidth = metrics.width;
                if (testWidth > maxWidth && n > 0) {
                    if(maxLine!=undefined && num >= maxLine){
                        ctx.fillText(line.substr(0,line.length-1)+'...', x, y);
                        return num;
                    }
                    num++;
                    ctx.fillText(line, x, y);
                    line = arrText[n];
                    y += lineHeight;
                } else {
                    line = testLine;
                }
            }
            ctx.fillText(line, x, y);
            return num;
        }
        //canvas加载图片
        function loadImg(url, cb){
            var img = new Image();
            img.setAttribute('crossOrigin', 'Anonymous');
            if (cb) {
                img.onload = cb;
            }
            img.src=url;
            return img;
        }
        //canvas画图时防止图片拉伸 自动显示中间的图片内容，其余部分裁剪掉
        function centerImg(img, ctx, x, y, w, h) {
            if (w/h > img.width/img.height) {
                var sh= img.width*h/w,
                sy = (img.height - sh) / 2;
                ctx.drawImage(img, 0, sy,img.width, sh, x, y, w, h)
            }else{
                var sw = img.height*w/h,
                sx =(img.width-sw)/2;
                ctx.drawImage(img,sx,0,sw,img.height,x,y,w,h)
            }
        }
        //画出圆角矩形的方法
        function drawRoundRect(cxt, x, y, width, height, radius) {
            cxt.beginPath();
            cxt.arc(x + radius, y + radius, radius, Math.PI, Math.PI * 3 / 2);
            cxt.lineTo(width - radius + x, y);
            cxt.arc(width - radius + x, radius + y, radius, Math.PI * 3 / 2, Math.PI * 2);
            cxt.lineTo(width + x, height + y - radius);
            cxt.arc(width - radius + x, height - radius + y, radius, 0, Math.PI * 1 / 2);
            cxt.lineTo(radius + x, height + y);
            cxt.arc(radius + x, height - radius + y, radius, Math.PI * 1 / 2, Math.PI);
            cxt.closePath();
        }

        function drawRoundRectPath(cxt, width, height, radius) {
            cxt.beginPath(0);
            //从右下角顺时针绘制，弧度从0到1/2PI
            cxt.arc(width - radius, height - radius, radius, 0, Math.PI / 2);

            //矩形下边线
            cxt.lineTo(radius, height);

            //左下角圆弧，弧度从1/2PI到PI
            cxt.arc(radius, height - radius, radius, Math.PI / 2, Math.PI);

            //矩形左边线
            cxt.lineTo(0, radius);

            //左上角圆弧，弧度从PI到3/2PI
            cxt.arc(radius, radius, radius, Math.PI, Math.PI * 3 / 2);

            //上边线
            cxt.lineTo(width - radius, 0);

            //右上角圆弧
            cxt.arc(width - radius, radius, radius, Math.PI * 3 / 2, Math.PI * 2);

            //右边线
            cxt.lineTo(width, height - radius);
            cxt.closePath();
        }
        // 实心方块， 支持圆角
        function fillRoundRect(cxt, x, y, width, height, radius, fillColor) {
            //圆的直径必然要小于矩形的宽高
            if (2 * radius > width || 2 * radius > height) { return false; }
            cxt.save();
            cxt.translate(x, y);
            //绘制圆角矩形的各个边
            drawRoundRectPath(cxt, width, height, radius);
            cxt.fillStyle = fillColor || "#000"; //若是给定了值就用给定的值否则给予默认值
            cxt.fill();
            cxt.restore();
        }
        var apiUrl = "https://lg.vzan.com/api/Logs"
        var _lgStartDate = new Date().getTime(); // 当前时间
        var _lastduration = 0;
        function ckVistLine() {
            var _lgEndDate = new Date().getTime(); // 请求时间
            var _lgDuration = parseInt((_lgEndDate - _lgStartDate) / 1000); // 请求时间 - 当前时间 = 下一次请求时间差
            var _sid = '5d10c7a4-d097-4f42-b341-388263becdf6';
            $.ajax({
                type: "POST",
                url: apiUrl,
                data: {
                    zbId:733664,
                    TopicId:1935643604,
                    sex:-1,
                    duration: _lgDuration,
                    tpStatus:1,
                    sid: _sid,
                    lastduration: _lastduration,
                    uid: "zbvz_userid" || 0,
                    LivesId: $.cookie("LivesId") || '',
                    uIp: "219.137.52.72"
                },
                dataType: 'json',
                // xhrFields: { withCredentials: true },
                crossDomain: true,
                complete: function () {
                    _lastduration = _lgDuration; // 记录上一次请求时间差
                    window.setTimeout(function () { ckVistLine() }, 5000);
                }
            });
        };
        setTimeout(function () {
            if (($.cookie('LivesId') || '') === '') {
                $.cookie('LivesId', "zbvz_userid", { expires: 365 * 10, path: '/', domain: document.location.host });
            };
            ckVistLine();
        }, 3000);
    </script>
</body>

<div style="display:none;">
    <script>
        wx.ready(function () {
            if ('1' == '1'&&false==false) {
                wxShareShow();
            }
            else {
                wx.hideOptionMenu();
            }
        });

        //微信分享(可用于动态修改)
        function wxShareShow(title, descript, imgurl, shareurl, states, callback) {
            var tip = "分享成功";
            var title = $(".live_title_bar").attr("attr-title") || title || "";
            var descript = $(".live_title_bar").attr("attr-descript") || descript || "";
            var imgurl = $(".live_title_bar").attr("attr-pic") || imgurl || "";
            var shareurl = $(".live_title_bar").attr("attr-url") || shareurl || "";
            var states = $(".live_title_bar").attr("attr-state") || states || "";
            var shareset = $(".live_title_bar").attr("attr-shareset") || 0;
            var callback = $(".live_title_bar").attr("attr-callback") || callback || null;
            if (descript == '') {
                descript = title;
            }
            if (location.hostname.toLowerCase() != "vzan.com") {
                var urlReg = /[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?/;
                try {
                    var c_host = urlReg.exec(shareurl)[0];
                    if (c_host.toLowerCase() != location.hostname.toLowerCase()) {
                        shareurl = shareurl.replace(c_host, location.hostname);
                    }
                } catch (ex) { }
            }
            if (shareset == 0) {
                switch (states) {
                    case '-1':
                        title += " 即将开播，敬请观看";
                        break;
                    case '1':
                        title += " 正在直播，邀您一起观看";
                        break;
                    case '0':
                        title += " 精彩回顾，等你观看";
                        break;
                }
            }
            //“分享给朋友”及“分享到QQ”
            wx.onMenuShareAppMessage({
                //wx.updateAppMessageShareData({
                title: title, //  分享标题
                desc: descript, //  分享链接
                link: shareurl, // 分享图标
                imgUrl: imgurl,
                //type: 'link',
                //dataUrl: '',
                success: function () {
                    layui.layer.msg("分享成功");
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });
            //分享到朋友圈”及“分享到QQ空间
            wx.onMenuShareTimeline({
                //wx.updateTimelineShareData({
                title: title, // 分享标题
                link: shareurl, // 分享链接
                imgUrl: imgurl, // 分享图标
                success: function () {
                    if (window.location.pathname.toLowerCase().match('livedetail|liveintroduce|channelpage|tvchat|liveing|shopindex') != null) {
                        var integral = addIntegral("分享朋友圈");
                        if (integral > 0) {
                            tip = "分享成功，恭喜获得" + integral + "个积分！！";
                        }
                    }
                    layui.layer.msg(tip);
                    //分享回调
                    if (typeof (menuShareCallBack) == "function") {
                        menuShareCallBack();
                    }
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });
            //分享到QQ
            wx.onMenuShareQQ({
                title: title, // 分享标题
                desc: descript, // 分享描述
                link: shareurl, // 分享链接
                imgUrl: imgurl, // 分享图标
                success: function () {
                    layui.layer.msg("分享成功");
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });
            //分享到腾讯微博
            wx.onMenuShareWeibo({
                title: title, // 分享标题
                desc: descript, // 分享描述
                link: shareurl, // 分享链接
                imgUrl: imgurl, // 分享图标
                success: function () {
                    layui.layer.msg("分享成功");
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });
            //分享到QQ空间
            wx.onMenuShareQZone({
                title: title, // 分享标题
                desc: descript, // 分享描述
                link: shareurl, // 分享链接
                imgUrl: imgurl, // 分享图标
                success: function () {
                    layui.layer.msg("分享成功");
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });
            wx.showOptionMenu();
        }

        //分享获得积分
        function addIntegral(remark) {
            var zbid = $(".live_title_bar").attr("attr-zbId") || "";
            if (zbid == "") {
                return 0;
            }
            var integral = 0;
            var postData = {
                zbid: zbid,
                integralType: 2,
                remark: remark
            };
            $.ajax({
                type: "POST",
                url: "/live/ChangeIntegral",
                data: postData,
                dataType: "json",
                async: false,
                success: function (res) {
                    if (res.isok) {
                        integral = res.dataObj;
                    }
                }
            });
            return integral;
        }

        //微信上传单张图片
        function UploadImageByWx(zbid,receiveImg){
            wx.chooseImage({
                count: 1,
                success: function (res) {
                    //上传图片
                    function upload() {
                        wx.uploadImage({
                            localId: res.localIds[0],
                            isShowProgressTips: 1,
                            success: function (res) {
                                layer.load(2);
                                //后台下载获取图片路径
                                $.ajax({
                                    type: "post",
                                    url: "/liveajax/UploadImages",
                                    data: { mediaId: res.serverId,zbid:zbid},
                                    dataType: "JSON",
                                    success: function (data) {
                                        layer.closeAll("loading");
                                        if (data && data.isok) {
                                            if(receiveImg){
                                                receiveImg(data.thumbimg);
                                            }
                                        }else{
                                            layer.msg(res.msg);
                                        }
                                    },
                                    error: function () {
                                        layer.closeAll("loading");
                                        layer.msg("error");
                                    }
                                });
                            },
                            fail: function (res) {
                                layer.msg("图片上传失败");
                            }
                        });
                    }
                    upload();
                }
            });
        }
    </script>
</div>
<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?5c88f64ce16c5100a4a8509273257ce4";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

</html>
